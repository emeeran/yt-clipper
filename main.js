/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var ye=Object.defineProperty;var Xe=Object.getOwnPropertyDescriptor;var Qe=Object.getOwnPropertyNames;var Je=Object.prototype.hasOwnProperty;var k=(l,t)=>()=>(l&&(t=l(l=0)),t);var Ce=(l,t)=>{for(var e in t)ye(l,e,{get:t[e],enumerable:!0})},Ze=(l,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Qe(t))!Je.call(l,i)&&i!==e&&ye(l,i,{get:()=>t[i],enumerable:!(r=Xe(t,i))||r.enumerable});return l};var et=l=>Ze(ye({},"__esModule",{value:!0}),l);var j,X,Ie,G,Ae=k(()=>{"use strict";j={GEMINI:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generateContent",GROQ:"https://api.groq.com/openai/v1/chat/completions",YOUTUBE_OEMBED:"https://www.youtube.com/oembed",CORS_PROXY:"https://api.allorigins.win/raw"},X={GEMINI:"gemini-2.5-pro",GROQ:"llama-3.3-70b-versatile"},Ie={"Google Gemini":[{name:"gemini-2.5-pro",supportsAudioVideo:!0},{name:"gemini-2.5-pro-tts",supportsAudioVideo:!0},{name:"gemini-2.5-flash",supportsAudioVideo:!0},{name:"gemini-2.5-flash-lite",supportsAudioVideo:!0},{name:"gemini-2.0-pro",supportsAudioVideo:!0},{name:"gemini-2.0-flash"},{name:"gemini-2.0-flash-lite"},{name:"gemini-1.5-pro"},{name:"gemini-1.5-flash"}],Groq:[{name:"llama-4-maverick-17b-128e-instruct"},{name:"llama-4-scout-17b-16e-instruct"},{name:"llama-3.3-70b-versatile"},{name:"llama-3.1-8b-instant"}],Ollama:[{name:"qwen3-coder:480b-cloud"},{name:"llama3.2"},{name:"llama3.1"},{name:"mistral"},{name:"mixtral"},{name:"gemma2"},{name:"phi3"},{name:"qwen2"},{name:"command-r"}]},G={FILE_CREATION_WAIT:300,MODAL_DELAY:100,FALLBACK_MODAL_CHECK:500,FOCUS_DELAY:150,REPAINT_DELAY:50}});var p,Oe=k(()=>{"use strict";p={PROCESSING:"Processing YouTube video...",SUCCESS:l=>`Successfully processed: ${l}`,OPENED_FILE:l=>`Opened: ${l}`,ERRORS:{INVALID_URL:"Invalid YouTube URL. Please provide a valid YouTube video URL (e.g., https://www.youtube.com/watch?v=VIDEO_ID)",MISSING_API_KEYS:"No valid Gemini or Groq API key configured. Please set one in plugin settings.",GEMINI_INVALID_KEY:"Gemini API key is invalid or missing. Please check your key.",GROQ_MODEL_NOT_FOUND:"Groq API error: Model not found or you do not have access. Please check your API key and model name.",FETCH_VIDEO_DATA:l=>`Failed to fetch video metadata: ${l}`,SAVE_FILE:l=>`Failed to save file: ${l}`,AI_PROCESSING:l=>`AI processing failed: ${l}`,FILE_NOT_EXISTS:"File no longer exists",COULD_NOT_OPEN:l=>`Could not open file: ${l}`,ENTER_URL:"Please enter a YouTube URL",VIDEO_ID_EXTRACTION:"Could not extract video ID from URL. Please check the URL format.",NETWORK_ERROR:"Network error occurred. Please check your internet connection and try again.",QUOTA_EXCEEDED:l=>`${l} API quota exceeded. Please check your plan and billing details, or try again later.`,RATE_LIMITED:l=>`${l} API rate limit reached. Please wait a moment and try again.`,BILLING_REQUIRED:l=>`${l} requires a paid plan. Please check your billing settings.`,CREDIT_EXHAUSTED:l=>`${l} API credits exhausted. Please top up your account or upgrade your plan.`},WARNINGS:{CORS_RESTRICTIONS:"Description not available due to CORS restrictions",EXTRACTION_FAILED:"Description extraction failed",AUTO_EXTRACTION:"Video description could not be extracted automatically."},MODALS:{YOUTUBE_PROCESSED:"YouTube Video Processed",CONFIRM_OPEN:l=>`Successfully processed YouTube video and saved as "${l}". Would you like to open the note now?`,CLOSE_CONFIRMATION:"Close without opening the note?",PROCESS_VIDEO:"Process YouTube Video",YES_OPEN:"Yes, open note",NO_THANKS:"No, thanks",CANCEL:"Cancel",PROCESS:"Process"},PLACEHOLDERS:{YOUTUBE_URL:"https://www.youtube.com/watch?v=...",GEMINI_KEY:"AIza...",GROQ_KEY:"gsk_...",OUTPUT_PATH:"YouTube/Processed Videos"}}});var $,Q,Le=k(()=>{"use strict";$={zIndex:"10000",display:"flex",header:{marginBottom:"15px",color:"var(--text-accent)"},message:{marginBottom:"20px",lineHeight:"1.5"},buttonContainer:{marginTop:"20px",display:"flex",gap:"10px",justifyContent:"flex-end"},button:{padding:"8px 16px",minWidth:"100px"}},Q={width:"100%",marginTop:"8px",padding:"8px",border:"1px solid var(--background-modifier-border)",borderRadius:"4px"}});var ke=k(()=>{"use strict"});var E=k(()=>{"use strict";Ae();Oe();Le();ke()});var M,Fe=k(()=>{"use strict";E();M=class l{static applyStyles(t,e){Object.assign(t.style,e)}static createButtonContainer(t){let e=t.createDiv();return this.applyStyles(e,$.buttonContainer),e}static createStyledButton(t,e,r=!1,i){let s=t.createEl("button",{text:e});return r&&s.classList.add("mod-cta"),this.applyStyles(s,$.button),i&&s.addEventListener("click",i),s}static createStyledInput(t,e,r,i=""){let s=t.createEl("input",{type:e,placeholder:r,value:i});return this.applyStyles(s,Q),s}static setupModalStyling(t){this.applyStyles(t,{zIndex:$.zIndex,display:$.display})}static createModalHeader(t,e){let r=t.createEl("h2",{text:e});return this.applyStyles(r,$.header),r}static createModalMessage(t,e){let r=t.createEl("p");return r.setText(e),this.applyStyles(r,$.message),r}static setupModalKeyHandlers(t,e,r){t.addEventListener("keydown",i=>{i.key==="Enter"&&(i.preventDefault(),i.stopPropagation(),e()),i.key==="Escape"&&r&&(i.preventDefault(),i.stopPropagation(),r())})}applyStyles(t,e){l.applyStyles(t,e)}createButtonContainer(t){return l.createButtonContainer(t)}createStyledButton(t,e,r=!1,i){return l.createStyledButton(t,e,r,i)}}});var $e={};Ce($e,{ConfirmationModal:()=>Se});var Se,xe=k(()=>{"use strict";N();Se=class extends A{constructor(e,r){super(e);this.options=r;this.result=!1}onOpen(){this.createModalContent(),this.setupEventHandlers(),this.focusConfirmButton()}createModalContent(){this.createHeader(this.options.title).setAttribute("id","confirmation-modal-title");let r=this.contentEl.createDiv("confirmation-message");r.setAttribute("id","confirmation-modal-description"),r.textContent=this.options.message;let i=this.createButtonContainer();i.style.marginTop="20px";let s=this.options.confirmText||"Confirm",n=this.options.cancelText||"Cancel";this.options.isDangerous||!1?(this.cancelButton=this.createButton(i,n,!1,()=>this.handleCancel()),this.cancelButton.setAttribute("aria-label",`Cancel: ${n}`),this.confirmButton=this.createButton(i,s,!0,()=>this.handleConfirm()),this.confirmButton.setAttribute("aria-label",`Confirm: ${s}`)):(this.confirmButton=this.createButton(i,s,!0,()=>this.handleConfirm()),this.confirmButton.setAttribute("aria-label",`Confirm: ${s}`),this.cancelButton=this.createButton(i,n,!1,()=>this.handleCancel()),this.cancelButton.setAttribute("aria-label",`Cancel: ${n}`)),this.contentEl.setAttribute("aria-labelledby","confirmation-modal-title"),this.contentEl.setAttribute("aria-describedby","confirmation-modal-description"),this.contentEl.setAttribute("role","alertdialog")}setupEventHandlers(){this.scope.register([],"Enter",()=>(this.handleConfirm(),!1)),this.scope.register([],"Escape",()=>(this.handleCancel(),!1))}focusConfirmButton(){this.confirmButton&&setTimeout(()=>{this.confirmButton.focus()},50)}handleConfirm(){this.result=!0,this.resolver&&this.resolver(!0),this.close()}handleCancel(){this.result=!1,this.resolver&&this.resolver(!1),this.close()}openAndWait(){return new Promise(e=>{this.resolver=e,this.open()})}getResult(){return this.result}}});var Be,q,A,N=k(()=>{"use strict";Fe();E();E();Be=require("obsidian"),q={modal:"ytc-modal",header:"ytc-modal-header",content:"ytc-modal-content",button:"ytc-modal-button",input:"ytc-modal-input"},A=class extends Be.Modal{constructor(e){super(e);this.events={};this.isDisposed=!1;this.setupModalStyling(),this.setupConflictPrevention()}setupModalStyling(){M.setupModalStyling(this.modalEl),this.modalEl.addClass(q.modal),this.contentEl.addClass(q.content)}setupConflictPrevention(){this.modalEl.setAttribute("data-plugin","youtube-clipper"),this.modalEl.style.zIndex="9999"}createHeader(e){let r=M.createModalHeader(this.contentEl,e);return r.addClass(q.header),r}createMessage(e){return M.createModalMessage(this.contentEl,e)}createButtonContainer(){return M.createButtonContainer(this.contentEl)}createButton(e,r,i=!1,s){let n=M.createStyledButton(e,r,i,s);return n.addClass(q.button),n.setAttribute("data-plugin","youtube-clipper"),n.setAttribute("role","button"),n.getAttribute("aria-label")||n.setAttribute("aria-label",r),n}createInput(e,r,i){let s=e.createEl("input",{type:r,placeholder:i});return M.applyStyles(s,Q),s.addClass(q.input),s.setAttribute("data-plugin","youtube-clipper"),i&&s.setAttribute("aria-label",i),s}setupKeyHandlers(e,r){let i=async()=>{try{await e()}catch(n){}},s=r?async()=>{try{await r()}catch(n){}}:void 0;M.setupModalKeyHandlers(this.contentEl,i,s)}focusElement(e,r=G.FOCUS_DELAY){setTimeout(()=>{e.focus()},r)}setEvents(e){this.events=e}confirmClose(e){return confirm(e)}async showConfirmationModal(e,r,i="Confirm",s="Cancel",n=!1){let{ConfirmationModal:o}=await Promise.resolve().then(()=>(xe(),$e));return new o(this.app,{title:e,message:r,confirmText:i,cancelText:s,isDangerous:n}).openAndWait()}forceVisible(){setTimeout(()=>{M.setupModalStyling(this.modalEl)},G.REPAINT_DELAY)}onClose(){if(this.isDisposed)return;this.isDisposed=!0;let{contentEl:e}=this;e.empty(),this.modalEl.removeClass(q.modal),this.modalEl.removeAttribute("data-plugin")}}});var it={};Ce(it,{default:()=>fe});module.exports=et(it);var I=class{static checkForPotentialConflicts(){let t=[];return['div[data-plugin="web-clipper"]',".web-clipper-modal"].forEach(r=>{let i=document.querySelectorAll(r);Array.from(i).filter(n=>!n.hasAttribute("data-plugin")||n.getAttribute("data-plugin")!==this.PLUGIN_ID).length>0&&t.push(`Detected potential plugin conflict: ${r}`)}),t}static markElement(t,e){t.setAttribute("data-plugin",this.PLUGIN_ID),t.setAttribute("data-ytc-type",e),t.addClass(`${this.CSS_PREFIX}-${e}`)}static unmarkElement(t){t.removeAttribute("data-plugin"),t.removeAttribute("data-ytc-type"),Array.from(t.classList).forEach(r=>{r.startsWith(this.CSS_PREFIX)&&t.removeClass(r)})}static createUniqueId(t){return`${this.CSS_PREFIX}-${t}-${Date.now()}`}static cleanupAllElements(){document.querySelectorAll(`[data-plugin="${this.PLUGIN_ID}"]`).forEach(e=>{e instanceof HTMLElement&&this.unmarkElement(e)})}static getStorageKey(t){return`${this.PLUGIN_ID}-${t}`}static log(t,e="info"){let r=new Date().toISOString(),i=`[${this.PLUGIN_ID}] ${r} - ${t}`;switch(e){case"warn":console.warn(i);break;case"error":console.error(i);break;default:console.log(i)}}static isSafeToOperate(){let t=this.checkForPotentialConflicts();return t.length>0?(this.log(`Potential conflicts detected: ${t.join(", ")}`,"warn"),!1):!0}static async safeOperation(t,e){try{this.log(`Starting ${e}`);let r=await t();return this.log(`Completed ${e}`),r}catch(r){throw this.log(`Error in ${e}: ${r}`,"error"),r}}};I.PLUGIN_ID="youtube-clipper",I.CSS_PREFIX="ytc";E();var J=require("obsidian"),y=class l{static handle(t,e,r=!0){let i=`${e}: ${t.message}`;r&&new J.Notice(`Error: ${t.message}`)}static async withErrorHandling(t,e,r=!0){try{return await t()}catch(i){return this.handle(i,e,r),null}}static withSyncErrorHandling(t,e,r=!0){try{return t()}catch(i){return this.handle(i,e,r),null}}static createAPIError(t,e,r,i){let s=`${t} API error: ${e} ${r}${i?`. ${i}`:""}`;return new Error(s)}static async handleAPIError(t,e,r){var s;let i=r||"";try{let n=await t.json();i=((s=n.error)==null?void 0:s.message)||n.message||r||""}catch(n){}throw this.createAPIError(e,t.status,t.statusText,i)}static validateConfiguration(t,e){let r=e.filter(i=>!t[i]);if(r.length>0)throw new Error(`Missing required configuration: ${r.join(", ")}`)}static createUserFriendlyError(t,e){let r=`Failed to ${e}: ${t.message}`;return new Error(r)}static handleQuotaError(t,e){let r=t.message.toLowerCase(),i="",s=!1;if(r.includes("quota")||r.includes("limit")||r.includes("exceeded")?r.includes("rate")||r.includes("too many requests")?(i=p.ERRORS.RATE_LIMITED(e),s=!0):r.includes("billing")||r.includes("payment")?i=p.ERRORS.BILLING_REQUIRED(e):r.includes("credit")||r.includes("balance")?i=p.ERRORS.CREDIT_EXHAUSTED(e):(i=p.ERRORS.QUOTA_EXCEEDED(e),s=!0):i=p.ERRORS.QUOTA_EXCEEDED(e),s){let n=new J.Notice(i,0);setTimeout(()=>{let a=n.noticeEl.createEl("button",{text:"Retry",cls:"mod-cta"});a.style.marginLeft="10px",a.onclick=()=>{n.hide(),window.dispatchEvent(new CustomEvent("yt-clipper-retry-processing"))}},100)}else new J.Notice(i,8e3)}static isQuotaError(t){let e=t.message.toLowerCase();return["quota","limit","exceeded","rate","billing","payment","credit","balance","insufficient","429","usage"].some(i=>e.includes(i))}static extractProviderName(t,e="AI Service"){let r=t.message.toLowerCase();return r.includes("gemini")||r.includes("google")?"Google Gemini":r.includes("groq")?"Groq":r.includes("openai")?"OpenAI":e}static handleEnhanced(t,e,r=!0){if(this.isQuotaError(t)){let i=this.extractProviderName(t);this.handleQuotaError(t,i);return}this.handle(t,e,r)}handle(t,e,r=!0){l.handle(t,e,r)}async withErrorHandling(t,e){return l.withErrorHandling(t,e)}};var Ee=(s=>(s[s.DEBUG=0]="DEBUG",s[s.INFO=1]="INFO",s[s.WARN=2]="WARN",s[s.ERROR=3]="ERROR",s[s.SILENT=4]="SILENT",s))(Ee||{}),be=class l{constructor(t={}){this.logs=[];this.config={level:1,enableConsole:!0,enableFile:!1,maxLogEntries:1e3,enableTimestamps:!0,...t}}static getInstance(t){return l.instance||(l.instance=new l(t)),l.instance}shouldLog(t){return t>=this.config.level}formatMessage(t){let e=Ee[t.level].padEnd(5),r=this.config.enableTimestamps?`[${t.timestamp.toISOString()}] `:"",i=t.context?` [${t.context}]`:"",s=t.data?` ${JSON.stringify(t.data)}`:"";return`${r}${e}${i} ${t.message}${s}`}addLogEntry(t,e,r,i){if(!this.shouldLog(t))return;let s={timestamp:new Date,level:t,message:e,context:r,data:i};if(this.logs.push(s),this.logs.length>this.config.maxLogEntries&&(this.logs=this.logs.slice(-this.config.maxLogEntries)),this.config.enableConsole){let n=this.formatMessage(s);switch(t){case 0:break;case 1:break;case 2:break;case 3:break}}}debug(t,e,r){this.addLogEntry(0,t,e,r)}info(t,e,r){this.addLogEntry(1,t,e,r)}warn(t,e,r){this.addLogEntry(2,t,e,r)}error(t,e,r){this.addLogEntry(3,t,e,r)}getLogs(t,e){let r=this.logs;return t!==void 0&&(r=r.filter(i=>i.level===t)),e&&(r=r.filter(i=>i.context===e)),r}clearLogs(){this.logs=[]}setLevel(t){this.config.level=t}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t}}plugin(t,e){this.info(t,"Plugin",e)}aiService(t,e){this.info(t,"AIService",e)}videoService(t,e){this.info(t,"VideoService",e)}fileService(t,e){this.info(t,"FileService",e)}modal(t,e){this.info(t,"Modal",e)}performance(t,e){this.debug(t,"Performance",e)}},c=be.getInstance();E();var Z=class{constructor(){this.state={isModalOpen:!1}}canOpenModal(t){return this.state.isModalOpen?t&&t!==this.state.pendingModalUrl?{canOpen:!1,reason:"Modal already open with different URL"}:{canOpen:!1,reason:"Modal already open with same URL"}:{canOpen:!0}}async openModal(t,e,r){let i=Math.random().toString(36).substring(2,9);this.state.lastCallId=i,c.info("Modal opening requested","ModalManager",{callId:i,url:t,currentState:{...this.state}});let{canOpen:s,reason:n}=this.canOpenModal(t);if(!s)return c.warn(`Modal open rejected: ${n}`,"ModalManager",{callId:i,url:t,reason:n,pendingUrl:this.state.pendingModalUrl}),t&&t!==this.state.pendingModalUrl&&(c.info("Updating pending modal URL","ModalManager",{oldUrl:this.state.pendingModalUrl,newUrl:t}),this.state.pendingModalUrl=t),null;this.state.isModalOpen=!0,this.state.pendingModalUrl=t,c.info("Modal state set to open","ModalManager",{callId:i,url:t});try{let o=()=>{try{c.info("Modal onClose triggered","ModalManager",{callId:i,url:t}),this.resetModalState(),r&&r()}catch(u){c.error("Error in modal onClose handler","ModalManager",{callId:i,error:u instanceof Error?u.message:String(u)}),this.resetModalState()}};c.info("About to open modal","ModalManager",{callId:i,url:t});let a=await e(),d=setTimeout(()=>{this.state.isModalOpen&&this.state.pendingModalUrl===t&&(c.warn("Fallback modal state reset triggered","ModalManager",{callId:i,url:t}),this.resetModalState())},1e4);return a&&typeof a=="object"?a._fallbackTimeout=d:(c.debug("Modal result is not an object, clearing fallback timeout","ModalManager",{callId:i,url:t,resultType:typeof a}),clearTimeout(d)),setTimeout(()=>{c.debug("Modal state after 100ms","ModalManager",{callId:i,isModalOpen:this.state.isModalOpen})},100),a}catch(o){throw c.error("Error opening modal","ModalManager",{callId:i,url:t,error:o instanceof Error?o.message:String(o)}),this.resetModalState(),o}}resetModalState(){c.debug("Resetting modal state","ModalManager",{previousState:{...this.state}}),this.state.isModalOpen=!1,this.state.pendingModalUrl=void 0}forceResetModalState(){c.warn("Force resetting modal state","ModalManager",{previousState:{...this.state}}),this.state={isModalOpen:!1}}getState(){return{...this.state}}isModalOpen(){return this.state.isModalOpen}getPendingModalUrl(){return this.state.pendingModalUrl}clear(){this.forceResetModalState(),c.info("Modal manager cleared","ModalManager")}};E();var h=class{static cleanYouTubeUrl(t){if(!t||typeof t!="string")return"";let e=t.trim();return e=e.replace(/[\u200B-\u200D\uFEFF]/g,""),!e.startsWith("http://")&&!e.startsWith("https://")&&(e="https://"+e),(e.startsWith("http://youtube.com")||e.startsWith("http://www.youtube.com"))&&(e=e.replace("http://","https://")),e}static extractVideoId(t){if(!t||typeof t!="string")return null;if(this.URL_CACHE.has(t))return this.URL_CACHE.get(t);let e=this.cleanYouTubeUrl(t),r=null,i=e.match(this.URL_PATTERNS[0]);if(i!=null&&i[1]&&this.VIDEO_ID_REGEX.test(i[1]))r=i[1];else for(let s=1;s<this.URL_PATTERNS.length&&!r;s++)i=e.match(this.URL_PATTERNS[s]),i!=null&&i[1]&&this.VIDEO_ID_REGEX.test(i[1])&&(r=i[1]);return this.URL_CACHE.size>100&&this.URL_CACHE.clear(),this.URL_CACHE.set(t,r),r}static isValidYouTubeUrl(t){return this.extractVideoId(t)!==null}static sanitizeFilename(t,e=100){return t.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g," ").trim().substring(0,e)}static isValidAPIKey(t,e){if(!t||typeof t!="string")return!1;switch(e){case"gemini":return t.startsWith("AIza")&&t.length>10;case"groq":return t.startsWith("gsk_")&&t.length>10;default:return!1}}static validateSettings(t){let e=[],r=!!t.useEnvironmentVariables;return!(this.isNonEmptyString(t.geminiApiKey)||this.isNonEmptyString(t.groqApiKey))&&!r&&e.push(p.ERRORS.MISSING_API_KEYS),this.isNonEmptyString(t.geminiApiKey)&&!this.isValidAPIKey(t.geminiApiKey,"gemini")&&e.push("Invalid Gemini API key format"),this.isNonEmptyString(t.groqApiKey)&&!this.isValidAPIKey(t.groqApiKey,"groq")&&e.push("Invalid Groq API key format"),r&&!this.isNonEmptyString(t.environmentPrefix)&&e.push("Environment variable prefix is required when using environment variables"),(!t.outputPath||typeof t.outputPath!="string")&&e.push("Output path is required"),{isValid:e.length===0,errors:e}}static isValidPath(t){return typeof t=="string"&&t.trim().length>0}static isNonEmptyString(t){return typeof t=="string"&&t.trim().length>0}static truncateText(t,e){return t.length<=e?t:t.substring(0,e-3)+"..."}static cleanText(t){return t.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\u([0-9a-fA-F]{4})/g,(e,r)=>String.fromCharCode(parseInt(r,16)))}};h.URL_PATTERNS=[/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})(?:&.*)?$/,/(?:https?:\/\/)?(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]{11})(?:\?.*)?$/,/(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]{11})(?:\?.*)?$/,/(?:https?:\/\/)?(?:www\.)?youtube\.com\/v\/([a-zA-Z0-9_-]{11})(?:\?.*)?$/,/(?:https?:\/\/)?(?:m\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})(?:&.*)?$/],h.VIDEO_ID_REGEX=/^[a-zA-Z0-9_-]{11}$/,h.URL_CACHE=new Map;var _=class _{createAnalysisPrompt(t,e,r="detailed-guide",i,s="balanced"){if(i&&i.trim())return this.applyCustomPrompt(i,t,e);let n;switch(s){case"fast":n=_.COMPACT_BASE_TEMPLATE;break;case"quality":n=_.COMPREHENSIVE_BASE_TEMPLATE;break;default:n=_.BALANCED_BASE_TEMPLATE}let o=n.replace("{{TITLE}}",t.title).replace("{{URL}}",e).replace("{{DESCRIPTION}}",t.description);switch(r){case"executive-summary":return this.createExecutiveSummaryPrompt(o,e,s);case"brief":return this.createBriefPrompt(o,e,s);case"detailed-guide":default:return this.createDetailedGuidePrompt(o,e,s)}}applyCustomPrompt(t,e,r){let i=h.extractVideoId(r),s=i?`https://www.youtube-nocookie.com/embed/${i}`:r;return t.replace(/__VIDEO_TITLE__/g,e.title||"Unknown Video").replace(/__VIDEO_DESCRIPTION__/g,e.description||"No description available").replace(/__VIDEO_URL__/g,r).replace(/__VIDEO_ID__/g,i||"unknown").replace(/__EMBED_URL__/g,s).replace(/__DATE__/g,new Date().toISOString().split("T")[0]).replace(/__TIMESTAMP__/g,new Date().toISOString())}createBriefPrompt(t,e,r="balanced"){let i=h.extractVideoId(e),s=i?`https://www.youtube-nocookie.com/embed/${i}`:e;return`${t}

        OUTPUT FORMAT - BRIEF DESCRIPTION + RESOURCES:

        Use this EXACT template:

        ---
        title: {Video Title}
        source: ${e}
        created: "${new Date().toISOString().split("T")[0]}"
        modified: "${new Date().toISOString().split("T")[0]}"
        description: "One short paragraph (3-4 sentences) summarizing the video"
        type: youtube-note
        format: brief
        tags:
          - youtube
          - brief
        status: processed
        duration: "[Extract video duration]"
        channel: "[Extract channel name]"
        video_id: "${i||"unknown"}"
        processing_date: "${new Date().toISOString()}"
    ai_provider: "__AI_PROVIDER__"
    ai_model: "__AI_MODEL__"
        ---

        <iframe width="640" height="360" src="${s}" title="{Video Title}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

        ---

        ## Brief Description
        [Provide a concise 3-4 sentence description that captures the core message of the video]

        ## Key Takeaways
        - **[Takeaway 1]**: [Core insight or lesson from the video]
        - **[Takeaway 2]**: [Core insight or lesson from the video]
        - **[Takeaway 3]**: [Core insight or lesson from the video]

        ## Quick Actions
        1. **[Immediate Action]**: [Specific action you can take right away]
        2. **[Next Step]**: [Follow-up action to apply what you learned]

        ## Resources
        - **Original Video:** [Watch on YouTube](${e})
        - **Channel:** [Creator's Channel](https://youtube.com/channel/[extract-channel-id])
        - **Top resources mentioned or related (links):**
          - [Resource 1]
          - [Resource 2]
          - [Resource 3]

        IMPORTANT: Keep the Brief Description short and focused. Provide 2-3 high-quality resource links that help the reader explore the topic further. Action items should be simple and immediately applicable.`}createExecutiveSummaryPrompt(t,e,r="balanced"){let i=h.extractVideoId(e),s=i?`https://www.youtube-nocookie.com/embed/${i}`:e,n={fast:"Fast Mode: transcript only",balanced:"Balanced Mode: transcript + primary visuals",quality:"Quality Mode: full multimodal analysis (audio, visuals, diagrams, slides, demonstrations)"},o=n[r]||n.balanced;return`## \u{1F3AF} YouTube \u2192 Obsidian Executive Summary Prompt (Tech/Developer Focus)

**ROLE:**
You are an expert technical analyst and executive summarizer. Your task is to extract high-value strategic insights from a technology-focused YouTube video and produce a concise, structured note for Obsidian.

---

Use this EXACT template:

---
title: {{TITLE}}
source: ${e}
created: "${new Date().toISOString().split("T")[0]}"
modified: "${new Date().toISOString().split("T")[0]}"
description: "Single sentence capturing the core insight"
type: youtube-note
format: executive-summary
tags:
  - youtube
  - executive-summary
  - technology
  - strategy
status: processed
duration: "[Extract video duration]"
channel: "[Extract channel name]"
video_id: "${i||"unknown"}"
processing_date: "${new Date().toISOString()}"
word_count: 250
ai_provider: "__AI_PROVIDER__"
ai_model: "__AI_MODEL__"
---

<div style="text-align: center; margin-bottom: 24px;">
<iframe width="640" height="360" src="${s}" title="{{TITLE}}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>

---

# \u{1F4CA} Executive Summary

The video discusses [explain the main problem/opportunity and the central argument of the video].

Key concepts include [summarize the most important concepts, frameworks, or differentiators that create impact].

To implement these insights, [provide recommendations, risks, and priority actions based on the insights].

> **\u{1F4A1} Focus:** Strategic value over narrative recap - prioritize actionable insights.

---

## \u{1F3AF} Key Strategic Insights

### \u{1F527} Technical Strategy
**[Critical insight with specific business impact and example from video]**

### \u{1F4A1} Design Thinking
**[Critical insight with specific business impact and example from video]**

### \u{1F4DA} Continuous Learning
**[Critical insight with specific business impact and example from video]**

> *Optional: Add 4\u20135 additional insights if they provide significant value.*

---

## \u{1F680} Action Plan & Implementation

### \u26A1 Immediate (0-30 days)
- **Action:** [Specific, measurable action]
- **Success Metric:** [Clear success criteria]

### \u{1F4C8} Short-term (1-3 months)
- **Action:** [Specific, measurable action]
- **Success Metric:** [Clear success criteria]

### \u{1F3AF} Mid-term (3-6 months)
- **Action:** [Specific, measurable action]
- **Success Metric:** [Clear success criteria]

### \u{1F52E} Long-term (6+ months)
- **Action:** [Specific, measurable action]
- **Success Metric:** [Clear success criteria]

> **\u2705 Requirement:** Each action item must include clear, measurable success criteria.

---

## \u{1F4DA} Curated Resources & References

### \u{1F3A5} Primary Sources
- **Original Video:** [Watch on YouTube](${e})
- **Channel:** [Creator's Channel](https://youtube.com/channel/[extract-channel-id])

### \u{1F6E0}\uFE0F Key Tools & Technologies
- [List main tools, frameworks, or technologies mentioned]

### \u{1F4D6} Official Documentation
- [Links to official documentation for mentioned technologies]

### \u{1F31F} Further Reading
- [1-2 high-quality related articles or resources for deep dive]

---

### Non-Negotiable Rules

- Executive Summary \u2264 250 words
- Insights & action items must reference the video
- Focus on strategy and developer/business value
- Avoid fluff and storytelling\u2014prioritize usable analysis

---

### Suggested Prompt Invocation

Analyze this YouTube video in **${o}**:
Title: {{TITLE}}
URL: ${e}
Description: {{DESCRIPTION}}
Return a structured Obsidian-ready note with strategic insights and developer-aligned action steps.`}createDetailedGuidePrompt(t,e,r="balanced"){let i=h.extractVideoId(e),s=i?`https://www.youtube-nocookie.com/embed/${i}`:e;return`${t}

        OUTPUT FORMAT - EFFICIENT STEP-BY-STEP TUTORIAL:

        Create a concise step-by-step tutorial following this structure:

        ---
        title: {{TITLE}}
        source: ${e}
        created: "${new Date().toISOString().split("T")[0]}"
        type: youtube-tutorial
        format: step-by-step
        tags: [youtube, tutorial, implementation, practical]
        status: processed
        channel: "[Extract channel name]"
        video_id: "${i||"unknown"}"
        ai_provider: "__AI_PROVIDER__"
        ai_model: "__AI_MODEL__"
        ---

        <div style="text-align: center; margin-bottom: 24px;">
        <iframe width="640" height="360" src="${s}" title="{{TITLE}}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>

        ---

        # [Title] - Practical Tutorial

        ## Overview
        **Goal:** [Main learning objective]
        **Duration:** [Estimated time]
        **Level:** [Difficulty]

        **Video:** [{{TITLE}}](${e})

        ## Prerequisites
        - [Requirement 1]
        - [Requirement 2]
        - [Requirement 3]

        ## Step-by-Step Guide

        ### Step 1: [Action/Setup]
        **Objective:** [Clear goal]

        **Actions:**
        1. [Specific instruction]
        2. [Follow-up instruction]
        3. [Verification step]

        \u2705 **Success:** [How to confirm it worked]

        ### Step 2: [Core Implementation]
        **Objective:** [Clear goal]

        [Continue with remaining steps...]

        ### Step 3: [Final Touches]
        **Objective:** [Clear goal]

        ## Learning Outcomes
        Upon completion, you will:
- [Achieved skill 1]
- [Achieved skill 2]
- [Achieved skill 3]

        ## Required Tools
        - **[Tool/Resource 1]:** [Where to get it]
        - **[Tool/Resource 2]:** [Where to get it]

        ## Pro Tips
        \u{1F4A1} **Tip 1:** [Key insight from video]
        \u{1F4A1} **Tip 2:** [Best practice]
        \u26A0\uFE0F **Avoid:** [Common mistake]

        ## Verification
        **Final Check:** [How to verify complete success]
        **Expected Result:** [What you should see/accomplish]

              *Generated from YouTube video content*`}processAIResponse(t,e,r,i){if(!t)return t;let s=e||"unknown",n=r||"unknown",o=t.replace(/__AI_PROVIDER__/g,s).replace(/__AI_MODEL__/g,n);return o=this.ensureFrontMatterValue(o,"ai_provider",s),o=this.ensureFrontMatterValue(o,"ai_model",n),o}ensureFrontMatterValue(t,e,r){let i=new RegExp(`(${e}\\s*:\\s*)(["'])?([^"'\\n]*)(["'])?`,"i");return i.test(t)?t.replace(i,(s,n,o,a,d)=>{let u=o||d?'"':"";return`${n}${u}${r}${u}`}):t.startsWith("---")?t.replace(/^---\s*\n/,`---
${e}: "${r}"
`):t}createSummaryPrompt(t,e){return`Create a concise summary for this YouTube video:

        Title: ${t.title}
        URL: ${e}
        Description: ${t.description}

        Please provide:
        1. A 2-paragraph summary (max 250 words)
        2. 3-5 key takeaways
        3. Main actionable insights

        Format as markdown with clear headings.`}validatePrompt(t){return!!t&&typeof t=="string"&&t.trim().length>10&&t.length<5e4}};_.COMPACT_BASE_TEMPLATE=`Analyze this YouTube video:
Title: {{TITLE}}
URL: {{URL}}
Description: {{DESCRIPTION}}

Focus on extracting the key information and insights.`,_.BALANCED_BASE_TEMPLATE=`Analyze this YouTube video with multimodal analysis:
Title: {{TITLE}}
URL: {{URL}}
Description: {{DESCRIPTION}}

Extract insights from both spoken content and visual elements, focusing on practical information.`,_.COMPREHENSIVE_BASE_TEMPLATE=`Analyze this YouTube video using comprehensive multimodal analysis:
Title: {{TITLE}}
URL: {{URL}}
Description: {{DESCRIPTION}}

MULTIMODAL ANALYSIS INSTRUCTIONS:
1. Watch the complete video using both audio and visual analysis capabilities
2. Extract insights from spoken content, music, sound effects, and ambient audio
3. Analyze visual elements including slides, diagrams, charts, body language, and demonstrations
4. Focus on practical, action-oriented information with specific examples
5. Maintain accuracy and cite specific examples from the video when relevant`;var ee=_;var D=class{static async executeWithRetry(t,e,r={}){let i={...this.defaultConfig,...r},s=Date.now(),n;c.info(`Starting retryable operation: ${e}`,"RetryService",{maxAttempts:i.maxAttempts,baseDelayMs:i.baseDelayMs});for(let a=1;a<=i.maxAttempts;a++)try{let d=await t(),u=Date.now()-s;return c.info(`Operation succeeded: ${e}`,"RetryService",{attempt:a,totalTimeMs:u}),{success:!0,result:d,attempts:a,totalTimeMs:u}}catch(d){if(n=d,c.warn(`Operation failed: ${e}`,"RetryService",{attempt:a,error:n.message,willRetry:a<i.maxAttempts&&this.isRetryableError(n,i)}),a===i.maxAttempts||!this.isRetryableError(n,i))break;let u=this.calculateDelay(a,i);c.debug(`Waiting ${u}ms before retry`,"RetryService",{attempt:a,delay:u}),await this.sleep(u)}let o=Date.now()-s;return c.error(`Operation failed after all retries: ${e}`,"RetryService",{attempts:i.maxAttempts,totalTimeMs:o,finalError:n==null?void 0:n.message}),{success:!1,error:n,attempts:i.maxAttempts,totalTimeMs:o}}static async withRetry(t,e,r=3,i=1e3){let s=await this.executeWithRetry(t,e,{maxAttempts:r,baseDelayMs:i});if(s.success)return s.result;throw s.error||new Error("Operation failed after retries")}static isRetryableError(t,e){let r=t.message.toLowerCase(),i=t.name.toLowerCase();for(let s of e.retryableErrors)if(r.includes(s.toLowerCase())||i.includes(s.toLowerCase()))return!0;if("status"in t){let s=t.status;return e.retryableStatusCodes.includes(s)}return!!(t instanceof TypeError&&t.message.includes("fetch"))}static calculateDelay(t,e){let r=e.baseDelayMs*Math.pow(e.backoffFactor,t-1);if(r=Math.min(r,e.maxDelayMs),e.jitter){let i=r*.25;r=r+(Math.random()-.5)*2*i}return Math.floor(r)}static sleep(t){return new Promise(e=>setTimeout(e,t))}static createRetryableFetch(t,e,r){return this.withRetry(async()=>{let i=await fetch(t,e);if(!i.ok){let s=new Error(`HTTP ${i.status}: ${i.statusText}`);throw s.status=i.status,s.statusText=i.statusText,s}return i},`fetch: ${typeof t=="string"?t:"request"}`,(r==null?void 0:r.maxAttempts)||3,(r==null?void 0:r.baseDelayMs)||1e3)}static async executeWithRetryConcurrently(t){c.info(`Executing ${t.length} operations concurrently with retry`,"RetryService");let e=t.map(({operation:n,name:o,config:a})=>this.executeWithRetry(n,o,a)),r=await Promise.all(e),i=r.filter(n=>n.success).length,s=r.length-i;return c.info("Concurrent operations completed","RetryService",{total:r.length,successful:i,failed:s}),r}static async executeWithRetrySeries(t){c.info(`Executing ${t.length} operations in series with retry`,"RetryService");let e=[];for(let{operation:s,name:n,config:o,continueOnError:a=!1}of t){let d=await this.executeWithRetry(s,n,o);if(e.push(d),!d.success&&!a){c.info(`Stopping series execution due to failure in: ${n}`,"RetryService");break}}let r=e.filter(s=>s.success).length,i=e.length-r;return c.info("Series operations completed","RetryService",{total:e.length,successful:r,failed:i}),e}};D.defaultConfig={maxAttempts:3,baseDelayMs:1e3,maxDelayMs:3e4,backoffFactor:2,retryableErrors:["ECONNRESET","ECONNREFUSED","ETIMEDOUT","ENOTFOUND","NETWORK_ERROR","TIMEOUT","Rate limit","Quota exceeded","Service unavailable"],retryableStatusCodes:[408,429,500,502,503,504],jitter:!0};var Pt=D.withRetry,Mt=D.createRetryableFetch;E();var V={fast:{name:"Fast",description:"Maximum speed with optimized models and parallel processing. Best for quick summaries.",timeouts:{geminiTimeout:15e3,groqTimeout:1e4,metadataTimeout:5e3},enableParallel:!0,preferMultimodal:!1,modelStrategy:{briefFormat:"llama-3.1-8b-instant",executiveSummary:"llama-3.3-70b-versatile",detailedGuide:"gemini-2.0-flash-lite",fallbackModel:"llama-3.1-8b-instant"}},balanced:{name:"Balanced",description:"Balanced speed and quality with multimodal analysis for detailed content.",timeouts:{geminiTimeout:3e4,groqTimeout:2e4,metadataTimeout:1e4},enableParallel:!0,preferMultimodal:!0,modelStrategy:{briefFormat:"llama-3.1-8b-instant",executiveSummary:"gemini-2.0-flash-lite",detailedGuide:"gemini-2.5-flash",fallbackModel:"llama-3.3-70b-versatile"}},quality:{name:"Quality",description:"Maximum quality with comprehensive multimodal analysis. Slower but most detailed.",timeouts:{geminiTimeout:6e4,groqTimeout:3e4,metadataTimeout:15e3},enableParallel:!1,preferMultimodal:!0,modelStrategy:{briefFormat:"gemini-2.0-flash-lite",executiveSummary:"gemini-2.5-flash",detailedGuide:"gemini-2.5-pro",fallbackModel:"gemini-2.0-flash"}}};var z={GEMINI:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generateContent",GROQ:"https://api.groq.com/openai/v1/chat/completions",YOUTUBE_OEMBED:"https://www.youtube.com/oembed",CORS_PROXY:"https://api.allorigins.win/raw"};var w={"Google Gemini":[{name:"gemini-2.5-pro",supportsAudioVideo:!0},{name:"gemini-2.5-pro-tts",supportsAudioVideo:!0},{name:"gemini-2.5-flash",supportsAudioVideo:!0},{name:"gemini-2.5-flash-lite",supportsAudioVideo:!0},{name:"gemini-2.0-pro",supportsAudioVideo:!0},{name:"gemini-2.0-flash"},{name:"gemini-2.0-flash-lite"},{name:"gemini-1.5-pro"},{name:"gemini-1.5-flash"}],Groq:[{name:"llama-4-maverick-17b-128e-instruct"},{name:"llama-4-scout-17b-16e-instruct"},{name:"llama-3.3-70b-versatile"},{name:"llama-3.1-8b-instant"}],Ollama:[{name:"qwen3-coder:480b-cloud"},{name:"llama3.2"},{name:"llama3.1"},{name:"mistral"},{name:"mixtral"},{name:"gemma2"},{name:"phi3"},{name:"qwen2"},{name:"command-r"}]},_e={"Google Gemini":"https://developers.generativeai.google/models",Groq:"https://groq.com",Ollama:"http://localhost:11434"},De={"Google Gemini":/gemini[-_\.]?\d+(?:\.\d+)?(?:-[a-z0-9\-]+)?/gi,Groq:/llama[-_\.]?\d+(?:\.\d+)?(?:-[a-z0-9\-]+)?/gi,Ollama:/[a-zA-Z0-9]+(?:[-_:][a-zA-Z0-9]+)*/g},Ue={MAX_TOKENS:8e3,TEMPERATURE:.7,DESCRIPTION_MAX_LENGTH:1e3,TITLE_MAX_LENGTH:100};var te=class{constructor(t={}){this.activeRequests=new Set;this.requestMetrics=[];this.pendingQueue=[];this.config={timeout:3e4,retries:3,retryDelay:1e3,maxConcurrent:10,keepAlive:!0,enableMetrics:!0,...t},this.maxConcurrent=this.config.maxConcurrent}async request(t,e={}){await this.waitForSlot();let r=new AbortController,i=setTimeout(()=>r.abort(),this.config.timeout),s={controller:r,startTime:performance.now(),url:t,method:e.method||"GET"};this.activeRequests.add(s);try{let n=await this.executeWithRetry(t,{...e,signal:r.signal,headers:{Connection:this.config.keepAlive?"keep-alive":"close","Keep-Alive":`timeout=${this.config.timeout/1e3}`,"User-Agent":"YouTube-Clipper/1.3.5",...e.headers}});if(clearTimeout(i),this.config.enableMetrics&&this.recordRequestMetrics({url:t,method:e.method||"GET",duration:performance.now()-s.startTime,success:n.ok,statusCode:n.status,retryCount:0}),!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);return n}finally{clearTimeout(i),this.activeRequests.delete(s),this.processQueue()}}async executeWithRetry(t,e){let r;for(let i=0;i<=this.config.retries;i++)try{return await fetch(t,e)}catch(s){if(r=s,i<this.config.retries){let n=this.config.retryDelay*Math.pow(2,i);await this.delay(n),this.config.enableMetrics&&console.debug(`Retrying request (attempt ${i+1}/${this.config.retries}): ${t}`)}}throw r}async post(t,e,r={}){return this.request(t,{method:"POST",headers:{"Content-Type":"application/json",...r.headers},body:JSON.stringify(e),...r})}async get(t,e={}){return this.request(t,{method:"GET",...e})}async put(t,e,r={}){return this.request(t,{method:"PUT",headers:{"Content-Type":"application/json",...r.headers},body:JSON.stringify(e),...r})}async delete(t,e={}){return this.request(t,{method:"DELETE",...e})}async waitForSlot(){if(!(this.activeRequests.size<this.maxConcurrent))return new Promise(t=>{this.pendingQueue.push(t)})}processQueue(){this.pendingQueue.length>0&&this.activeRequests.size<this.maxConcurrent&&this.pendingQueue.shift()()}delay(t){return new Promise(e=>setTimeout(e,t))}recordRequestMetrics(t){let e={retryCount:0,...t};this.requestMetrics.push(e),this.requestMetrics.length>1e3&&(this.requestMetrics=this.requestMetrics.slice(-1e3))}getMetrics(){let t=this.requestMetrics.length,e=this.activeRequests.size,r=this.requestMetrics.filter(n=>n.success).length,i=this.requestMetrics.filter(n=>{var o,a;return((o=n.error)==null?void 0:o.includes("abort"))||((a=n.error)==null?void 0:a.includes("timeout"))}).length,s=this.requestMetrics.map(n=>n.duration).filter(n=>n>0);return{totalRequests:t,activeRequests:e,maxConcurrent:this.maxConcurrent,utilizationRate:e/this.maxConcurrent,averageResponseTime:s.length>0?s.reduce((n,o)=>n+o,0)/s.length:0,successRate:t>0?r/t:0,errorRate:t>0?(t-r)/t:0,timeouts:i}}getDetailedMetrics(){let t={};this.requestMetrics.forEach(i=>{if(i.statusCode){let s=Math.floor(i.statusCode/100)*100;t[s]=(t[s]||0)+1}});let e={},r=this.groupBy(this.requestMetrics,"method");return Object.entries(r).forEach(([i,s])=>{let n=this.analyzeMetrics(s);e[i]=n}),{requests:this.requestMetrics,performanceBreakdown:{byStatus:t,byMethod:e,byTimeRange:{lastHour:this.getMetricsByTimeRange(Date.now()-36e5),lastDay:this.getMetricsByTimeRange(Date.now()-864e5),lastWeek:this.getMetricsByTimeRange(Date.now()-6048e5)}}}}groupBy(t,e){let r={};return t.forEach(i=>{let s=String(i[e]);r[s]||(r[s]=[]),r[s].push(i)}),r}analyzeMetrics(t){let e=t.length,r=t.map(s=>s.duration),i=t.filter(s=>s.success);return{count:e,averageTime:r.length>0?r.reduce((s,n)=>s+n,0)/r.length:0,successRate:e>0?i.length/e:0}}getMetricsByTimeRange(t){return this.requestMetrics.filter(e=>e.timestamp>=t).length}setMaxConcurrent(t){this.maxConcurrent=Math.max(1,t)}abortAllRequests(){this.activeRequests.forEach(t=>{t.controller.abort()}),this.activeRequests.clear(),this.pendingQueue.length=0}cleanup(){this.abortAllRequests(),this.requestMetrics=[]}};var Te=class{constructor(t=!0){this.metrics=new Map;this.observers=[];this.enabled=!0;this.enabled=t,t&&(this.setupPerformanceObservers(),this.setupMemoryMonitoring())}setupPerformanceObservers(){if("PerformanceObserver"in window){let t=new PerformanceObserver(e=>{e.getEntries().forEach(r=>{this.recordMetric("long-task",{duration:r.duration,startTime:r.startTime,name:r.name})})});try{t.observe({entryTypes:["longtask"]}),this.observers.push(t)}catch(e){console.warn("Long task observer not supported:",e)}try{let e=new PerformanceObserver(r=>{let i=r.getEntries()[0];i&&this.recordMetric("navigation",{domContentLoaded:i.domContentLoadedEventEnd-i.domContentLoadedEventStart,loadComplete:i.loadEventEnd-i.loadEventStart,firstPaint:this.getFirstPaint(),firstContentfulPaint:this.getFirstContentfulPaint()})});e.observe({entryTypes:["navigation"]}),this.observers.push(e)}catch(e){console.warn("Navigation observer not supported:",e)}}}setupMemoryMonitoring(){setInterval(()=>{this.isMemoryUsageHigh()&&this.recordMetric("memory-warning",{duration:0,timestamp:Date.now(),metadata:{memoryUsage:this.getMemoryUsage()}})},3e4)}async measureOperation(t,e,r){if(!this.enabled)return e();let i=performance.now();try{let s=await e(),n=performance.now()-i;return this.recordMetric(t,{duration:n,success:!0,timestamp:Date.now(),metadata:r}),s}catch(s){let n=performance.now()-i;throw this.recordMetric(t,{duration:n,success:!1,error:s instanceof Error?s.message:"Unknown error",timestamp:Date.now(),metadata:r}),s}}recordMetric(t,e){if(!this.enabled)return;let r={duration:0,timestamp:Date.now(),...e};this.metrics.has(t)||this.metrics.set(t,[]);let i=this.metrics.get(t);i.push(r),i.length>1e3&&i.splice(0,i.length-1e3),r.duration>5e3&&console.warn(`Slow operation detected: ${t} took ${r.duration.toFixed(2)}ms`)}getMetricsSummary(t){let e=this.metrics.get(t)||[];if(e.length===0)return{count:0,average:0,min:0,max:0,p50:0,p95:0,p99:0,successRate:0};let r=e.filter(s=>typeof s.duration=="number").map(s=>s.duration).sort((s,n)=>s-n),i=e.filter(s=>s.success!==!1).length;return{count:e.length,average:r.reduce((s,n)=>s+n,0)/r.length,min:Math.min(...r),max:Math.max(...r),p50:this.getPercentile(r,.5),p95:this.getPercentile(r,.95),p99:this.getPercentile(r,.99),successRate:i/e.length}}generateReport(){let t={timestamp:new Date().toISOString(),metrics:{},systemInfo:this.getSystemInfo(),recommendations:[]};return this.metrics.forEach((e,r)=>{t.metrics[r]=this.getMetricsSummary(r)}),t.recommendations=this.generateRecommendations(t),t}generateRecommendations(t){let e=[],r=t.metrics["video-processing"];r&&r.p95>6e4&&e.push("Consider optimizing video processing - 95th percentile time exceeds 60s"),Object.entries(t.metrics).forEach(([n,o])=>{o.successRate<.95&&e.push(`${n} success rate below 95% (${(o.successRate*100).toFixed(1)}%)`)});let i=t.metrics["long-task"];i&&i.max>100&&e.push("Long blocking tasks detected - consider breaking up complex operations"),this.isMemoryUsageHigh()&&e.push("High memory usage detected - consider implementing more aggressive cleanup");let s=t.metrics.navigation;return s&&(s.average>3e3&&e.push("Slow page load detected - consider optimizing bundle size"),s.p95>5e3&&e.push("Poor navigation performance for 95th percentile users")),e}getSystemInfo(){return{userAgent:navigator.userAgent,platform:navigator.platform,memory:performance.memory?{used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit}:void 0,connection:navigator.connection?{effectiveType:navigator.connection.effectiveType,downlink:navigator.connection.downlink}:void 0}}getPercentile(t,e){let r=Math.ceil(t.length*e)-1;return t[Math.max(0,r)]||0}getFirstPaint(){let e=performance.getEntriesByType("paint").find(r=>r.name==="first-paint");return e?e.startTime:null}getFirstContentfulPaint(){let e=performance.getEntriesByType("paint").find(r=>r.name==="first-contentful-paint");return e?e.startTime:null}isMemoryUsageHigh(){if(performance.memory){let t=performance.memory.usedJSHeapSize,e=performance.memory.jsHeapSizeLimit;return t/e>.8}return!1}getMemoryUsage(){var t;return((t=performance.memory)==null?void 0:t.usedJSHeapSize)||0}getAllMetrics(){let t={};return this.metrics.forEach((e,r)=>{t[r]=this.getMetricsSummary(r)}),t}setEnabled(t){this.enabled=t,t?this.setupPerformanceObservers():(this.observers.forEach(e=>{e.disconnect()}),this.observers=[])}clearMetrics(){this.metrics.clear()}exportMetrics(){return JSON.stringify({timestamp:new Date().toISOString(),metrics:Object.fromEntries(this.metrics),systemInfo:this.getSystemInfo()},null,2)}destroy(){this.setEnabled(!1),this.clearMetrics()}},Y=new Te;var re=class{constructor(t,e){this.providers=[];if(!t||t.length===0)throw new Error(p.ERRORS.MISSING_API_KEYS);this.providers=t,this.settings=e;let r=V[e.performanceMode]||V.balanced;this.httpClient=new te({timeout:r.timeouts.geminiTimeout,retries:2,retryDelay:1e3,maxConcurrent:e.enableParallelProcessing?5:3,keepAlive:!0,enableMetrics:!0}),this.applyPerformanceSettings()}applyPerformanceSettings(){let t=V[this.settings.performanceMode]||V.balanced,e=this.settings.customTimeouts||t.timeouts;this.providers.forEach(r=>{r.name==="Google Gemini"&&r.setTimeout?r.setTimeout(e.geminiTimeout):r.name==="Groq"&&r.setTimeout&&r.setTimeout(e.groqTimeout)})}updateSettings(t){this.settings=t,this.applyPerformanceSettings()}getProviderModels(t){return(w[t]||[]).map(r=>typeof r=="string"?r:r&&r.name?r.name:String(r))}async fetchLatestModels(){let t={},e=this.getProviderNames();for(let r of e)try{let i=await this.fetchLatestModelsForProvider(r);t[r]=i.length>0?i:w[r]?w[r].map(s=>typeof s=="string"?s:s.name):[]}catch(i){c.error(`Error fetching models for ${r}`,"AIService",{error:i instanceof Error?i.message:String(i)}),t[r]=w[r]?w[r].map(s=>typeof s=="string"?s:s.name):[]}return t}async fetchLatestModelsForProvider(t){return await Y.measureOperation(`fetch-models-${t}`,async()=>{if(t==="Ollama"){try{let s="http://localhost:11434",n=await this.httpClient.get(`${s}/api/tags`,{headers:{"Content-Type":"application/json"}});if(n.ok){let o=await n.json();if(o&&o.models&&Array.isArray(o.models)){let a=o.models.map(d=>d.name?d.name:d.id?d.id:"").filter(d=>d!=="");return c.debug(`Fetched ${a.length} models from local Ollama instance`,"AIService",{models:a.slice(0,10)}),a}}else c.warn(`Ollama instance not accessible at ${s}, using static list`,"AIService")}catch(s){c.warn("Ollama instance not accessible, using static model list","AIService",{error:s instanceof Error?s.message:String(s)})}return c.debug("Using static Ollama models list","AIService"),w[t]?w[t].map(s=>typeof s=="string"?s:s.name):[]}let e=_e[t],r=De[t];if(!e||!r)return w[t]?w[t].map(i=>typeof i=="string"?i:i.name):[];try{c.debug(`Fetching latest models for ${t}`,"AIService",{url:e});let i=await this.httpClient.get(e,{headers:{"User-Agent":"Mozilla/5.0 (compatible; YT-Clipper/1.3.5)"}});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);let n=(await i.text()).match(r)||[],o=Array.from(new Set(n.map(a=>a.toLowerCase())));return c.debug(`Found ${o.length} models for ${t}`,"AIService",{models:o.slice(0,5)}),o}catch(i){return c.error(`Error fetching models for ${t}`,"AIService",{error:i instanceof Error?i.message:String(i),providerName:t}),w[t]?w[t].map(s=>typeof s=="string"?s:s.name):[]}},{provider:t,operation:"fetchLatestModelsForProvider"})}async process(t,e){if(!t||typeof t!="string")throw new Error("Valid prompt is required");return await Y.measureOperation("ai-process",async()=>this.settings.enableParallelProcessing?this.processParallel(t,e):this.processSequential(t,e),{promptLength:t.length,hasImages:e&&e.length>0,processingMode:this.settings.enableParallelProcessing?"parallel":"sequential"})}async processSequential(t,e){let r=null;for(let s of this.providers)try{c.info(`Attempting to process with ${s.name}`,"AIService",{model:s.model});let n;if(e&&e.length>0&&s.processWithImage?n=await D.withRetry(()=>s.processWithImage(t,e),`${s.name}-process-multimodal`,2,2e3):n=await D.withRetry(()=>s.process(t),`${s.name}-process`,2,2e3),n&&n.trim().length>0)return c.info(`Successfully processed with ${s.name}`,"AIService",{model:s.model,contentLength:n.length}),{content:n,provider:s.name,model:s.model};throw new Error("Empty response from AI provider")}catch(n){if(r=n,c.warn(`${s.name} failed`,"AIService",{error:n instanceof Error?n.message:String(n),model:s.model}),s===this.providers[this.providers.length-1])break}let i=r?p.ERRORS.AI_PROCESSING(r.message):"All AI providers failed to process the request";throw new Error(i)}async processParallel(t,e){let r=this.providers.map(async o=>{try{let a;if(e&&e.length>0&&o.processWithImage?a=await o.processWithImage(t,e):a=await o.process(t),a&&a.trim().length>0)return{content:a,provider:o.name,model:o.model,success:!0,responseTime:Date.now()};throw new Error("Empty response from AI provider")}catch(a){return{error:a.message,provider:o.name,model:o.model,success:!1,responseTime:Date.now()}}}),i=await Promise.allSettled(r);for(let o of i)if(o.status==="fulfilled"&&o.value.success)return{content:o.value.content,provider:o.value.provider,model:o.value.model};let s=i.filter(o=>o.status==="fulfilled"&&!o.value.success).map(o=>o.value.error),n=s.length>0?p.ERRORS.AI_PROCESSING(s.join("; ")):"All AI providers failed to process the request";throw new Error(n)}async processWith(t,e,r,i){let s=this.providers.find(n=>n.name===t);if(!s)throw new Error(`AI provider not found: ${t}`);try{r&&typeof s.setModel=="function"&&s.setModel(r);let n;if(i&&i.length>0&&s.processWithImage?n=await s.processWithImage(e,i):n=await s.process(e),n&&n.trim().length>0)return{content:n,provider:s.name,model:s.model};throw new Error("Empty response from AI provider")}catch(n){throw new Error(p.ERRORS.AI_PROCESSING(n.message))}}hasAvailableProviders(){return this.providers.length>0}getProviderNames(){return this.providers.map(t=>t.name)}addProvider(t){this.providers.push(t)}removeProvider(t){let e=this.providers.findIndex(r=>r.name===t);return e!==-1?(this.providers.splice(e,1),!0):!1}getPerformanceMetrics(){return{httpMetrics:this.httpClient.getMetrics(),aiProcessingMetrics:Y.getMetricsSummary("ai-process"),modelFetchMetrics:Object.fromEntries(this.providers.map(t=>[`fetch-models-${t.name}`,Y.getMetricsSummary(`fetch-models-${t.name}`)]))}}cleanup(){var t;(t=this.httpClient)==null||t.cleanup()}};E();var U=class{constructor(t,e,r){this.apiKey=t;this._timeout=3e4;this._maxTokens=2048;this._temperature=.7;this._model=e||"",r&&(this._timeout=r)}get model(){return this._model}get timeout(){return this._timeout}get maxTokens(){return this._maxTokens}get temperature(){return this._temperature}setModel(t){this._model=t}setTimeout(t){this._timeout=t}setMaxTokens(t){this._maxTokens=t}setTemperature(t){this._temperature=t}async processWithTimeout(t,e){let r=e||this._timeout,i=new Promise((n,o)=>{setTimeout(()=>{o(new Error(`${this.name} request timed out after ${r}ms`))},r)}),s=this.process(t);return Promise.race([s,i])}validateResponse(t,e){let r=t;for(let i of e){if(!r||typeof r!="object"||!(i in r))return!1;r=r[i]}return r!=null}async safeJsonParse(t){try{return await t.json()}catch(e){return null}}async handleAPIError(t){return y.handleAPIError(t,this.name)}};E();var ie=class extends U{constructor(e,r,i){super(e,r||X.GEMINI,i);this.name="Google Gemini"}async process(e){var r,i;try{if(!this.apiKey||this.apiKey.trim().length===0)throw new Error(p.ERRORS.GEMINI_INVALID_KEY);let s=await fetch(`${j.GEMINI}?key=${this.apiKey}`,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e))});if(s.status===400){let o=await this.safeJsonParse(s),a=((r=o==null?void 0:o.error)==null?void 0:r.message)||"Bad request";throw new Error(`Gemini API error: ${a}. Try checking the model configuration.`)}if(s.status===401)throw new Error(p.ERRORS.GEMINI_INVALID_KEY);if(s.status===403)throw new Error("Gemini API quota exceeded or billing required. Please check your plan and billing details.");if(s.status===429)try{let o=await s.json(),a=((i=o.error)==null?void 0:i.message)||o.message||"";throw a.toLowerCase().includes("quota")?new Error(`Gemini API quota exceeded: ${a}. Please check your plan and billing details.`):a.toLowerCase().includes("rate")?new Error(`Gemini API rate limit exceeded: ${a}. Please wait a moment and try again.`):new Error("Gemini API rate limit exceeded. Please wait and try again.")}catch(o){throw new Error("Gemini API rate limit exceeded. Please wait and try again.")}s.ok||await this.handleAPIError(s);let n=await s.json();if(!n.candidates||!n.candidates.length)throw new Error("No response candidates returned from Gemini API");if(n.candidates[0].finishReason==="SAFETY")throw new Error("Response blocked by Gemini safety filters. Try rephrasing.");if(!this.validateResponse(n,["candidates","0","content","parts","0","text"]))throw new Error("Invalid response format from Gemini API");return this.extractContent(n)}catch(s){throw s instanceof Error?s:new Error(`Gemini processing failed: ${s}`)}}createHeaders(){return{"Content-Type":"application/json"}}createRequestBody(e){let r=e.toLowerCase(),i=r.includes("youtube video")||r.includes("youtu.be/")||r.includes("youtube.com/"),s={contents:[{parts:[{text:e}]}],generationConfig:{temperature:this._temperature,maxOutputTokens:this._maxTokens,candidateCount:1}};if(i){let n=Ie["Google Gemini"]||[],o=String(this.model||"").toLowerCase(),a=n.find(m=>{let v=typeof m=="string"?m:m&&m.name?m.name:"";return String(v).toLowerCase()===o}),d=a&&a.supportsAudioVideo===!0,u={...s,systemInstruction:{parts:[{text:`You are an expert video content analyzer. Provide comprehensive, multimodal analysis using:
\u2022 AUDIO STREAM: Transcribe all spoken content, identify speakers, capture tone/emphasis/emotion
\u2022 VIDEO STREAM: Analyze visual elements, text overlays, diagrams, slides, gestures, scene changes, and visual demonstrations
\u2022 INTEGRATED INSIGHTS: Synthesize audio and visual data to provide complete understanding

For best results:
- Prioritize accuracy in transcription and speaker identification
- Extract and explain key concepts shown visually
- Note timing relationships between audio and visual elements
- Identify visual cues that reinforce or clarify spoken content`}]}},g=e.match(/(gs:\/\/[\w\-\.\/]+\.(?:mp4|mov|mkv|webm))/i);if(g&&g[1]){let m=g[1];u.contents=u.contents||[],u.contents.push({parts:[{fileData:{fileUri:m,mimeType:"video/mp4"}}]})}return u}return s}extractContent(e){let r=e.candidates[0].content.parts[0].text;return r?r.trim():""}};E();E();var se=class extends U{constructor(e,r,i){super(e,r||X.GROQ,i);this.name="Groq"}async process(e){var s;let r=await fetch(j.GROQ,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e))});if(r.status===401)throw new Error("Groq API key is invalid or missing. Please check your key.");if(r.status===402)throw new Error("Groq API requires a paid plan. Please check your billing settings.");if(r.status===404)throw new Error(p.ERRORS.GROQ_MODEL_NOT_FOUND);if(r.status===429)try{let n=await r.json(),o=((s=n.error)==null?void 0:s.message)||n.message||"";throw o.toLowerCase().includes("quota")?new Error(`Groq API quota exceeded: ${o}. Please check your plan and billing details.`):o.toLowerCase().includes("rate")?new Error(`Groq API rate limit exceeded: ${o}. Please wait a moment and try again.`):new Error("Groq API rate limit exceeded. Please wait and try again.")}catch(n){throw new Error("Groq API rate limit exceeded. Please wait and try again.")}r.ok||await this.handleAPIError(r);let i=await r.json();if(!this.validateResponse(i,["choices","0","message"]))throw new Error("Invalid response format from Groq API");return this.extractContent(i)}createHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`}}createRequestBody(e){return{model:this.model,messages:[{role:"system",content:"You are an expert content analyzer specializing in extracting practical value and creating actionable guides from video content. Focus on clarity, practicality, and immediate implementability. Even with limited information, provide maximum value through structured analysis and practical recommendations."},{role:"user",content:e}],max_tokens:this._maxTokens,temperature:this._temperature}}extractContent(e){let r=e.choices[0].message.content;return r?r.trim():""}};var tt={maxSize:200,defaultTTL:3e5,cleanupInterval:6e4,enableMetrics:!0},ne=class{constructor(t={}){this.cache=new Map;this.accessOrder=[];this.metrics={hits:0,misses:0,evictions:0,size:0,hitRate:0};this.lastCleanup=0;this.config={...tt,...t}}get(t){var i;this.cache.size>this.config.maxSize*.8&&this.cleanup();let e=this.cache.get(t);if(!e)return this.config.enableMetrics&&(this.metrics.misses++,this.updateHitRate()),null;let r=(i=e.ttl)!=null?i:this.config.defaultTTL;return Date.now()-e.timestamp>r?(this.cache.delete(t),this.removeFromAccessOrder(t),null):(this.updateAccessOrder(t),e.hits++,this.config.enableMetrics&&(this.metrics.hits++,this.updateHitRate()),e.data)}set(t,e,r){this.cache.size>=this.config.maxSize&&this.evictLRU();let i={data:e,timestamp:Date.now(),ttl:r||this.config.defaultTTL,hits:0,size:this.estimateSize(e)};this.cache.set(t,i),this.updateAccessOrder(t),this.metrics.size=this.cache.size}clear(){this.cache.clear(),this.accessOrder=[],this.metrics={hits:0,misses:0,evictions:0,size:0,hitRate:0}}delete(t){let e=this.cache.delete(t);return e&&(this.removeFromAccessOrder(t),this.metrics.size=this.cache.size),e}has(t){var i;let e=this.cache.get(t);if(!e)return!1;let r=(i=e.ttl)!=null?i:this.config.defaultTTL;return Date.now()-e.timestamp>r?(this.cache.delete(t),this.removeFromAccessOrder(t),this.metrics.size=this.cache.size,!1):!0}size(){return this.cache.size}getMetrics(){return{...this.metrics}}updateAccessOrder(t){this.removeFromAccessOrder(t),this.accessOrder.push(t)}removeFromAccessOrder(t){let e=this.accessOrder.indexOf(t);e>-1&&this.accessOrder.splice(e,1)}evictLRU(){if(this.accessOrder.length===0)return;let t=this.accessOrder.shift();this.cache.delete(t),this.metrics.evictions++,this.metrics.size=this.cache.size}estimateSize(t){if(t==null)return 8;if(typeof t=="string")return t.length*2;if(typeof t=="number")return 8;if(typeof t=="boolean")return 4;if(typeof t=="object")try{return JSON.stringify(t).length*2}catch(e){return 1024}return 64}updateHitRate(){let t=this.metrics.hits+this.metrics.misses;this.metrics.hitRate=t>0?this.metrics.hits/t:0}cleanup(){var r;let t=Date.now();if(t-this.lastCleanup<this.config.cleanupInterval)return;this.lastCleanup=t;let e=[];for(let[i,s]of this.cache.entries()){let n=(r=s.ttl)!=null?r:this.config.defaultTTL;t-s.timestamp>n&&e.push(i)}e.forEach(i=>{this.cache.delete(i),this.removeFromAccessOrder(i)}),this.metrics.size=this.cache.size}getHotItems(t=10){return Array.from(this.cache.entries()).map(([r,i])=>({key:r,hits:i.hits})).sort((r,i)=>i.hits-r.hits).slice(0,t)}getStats(){let t=Array.from(this.cache.values()).reduce((e,r)=>e+r.size,0);return{size:this.cache.size,maxSize:this.config.maxSize,hitRate:this.metrics.hitRate,totalHits:this.metrics.hits,totalMisses:this.metrics.misses,evictions:this.metrics.evictions,memoryUsage:t}}destroy(){this.clear(),this.accessOrder=[]}};N();xe();var He=require("obsidian");N();E();var Ne=require("obsidian");N();var rt="A note with this title already exists. Choose how to proceed.",oe=class extends A{constructor(e,r){super(e);this.file=r;this.decision="cancel"}onOpen(){this.createHeader("Note Already Exists"),this.createMessage(`${rt}

Existing note: ${this.file.path}`),this.createButtons()}openAndWait(){return new Promise(e=>{this.resolve=e,this.forceVisible(),this.open()})}onClose(){this.resolve&&this.resolve(this.decision),super.onClose()}createButtons(){let e=this.createButtonContainer();this.createButton(e,"Cancel",!1,()=>{this.closeWithDecision("cancel")}),this.createButton(e,"Save as Numbered Copy",!1,()=>{this.closeWithDecision("new-name")}),this.createButton(e,"Overwrite Existing",!0,()=>{this.closeWithDecision("overwrite")})}closeWithDecision(e){this.decision=e,this.close()}};E();E();var ae=require("obsidian"),ce=class{constructor(t){this.app=t}async saveToFile(t,e,r){try{let i=this.createSafeFilename(t),s=this.normalizePath(r);await this.ensureDirectoryExists(s);let n=this.getDailyFolderPath(s);await this.ensureDirectoryExists(n);let o=`${n}/${i}`;return await this.handleFileConflicts(o,e)}catch(i){throw new Error(p.ERRORS.SAVE_FILE(i.message))}}async openFileWithConfirmation(t){await this.waitForFileCreation();try{let e=this.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof ae.TFile))throw new Error(p.ERRORS.FILE_NOT_EXISTS);await this.app.workspace.getLeaf(!1).openFile(e)}catch(e){throw new Error(p.ERRORS.COULD_NOT_OPEN(e.message))}}createSafeFilename(t){return`${h.sanitizeFilename(t)}.md`}async ensureDirectoryExists(t){try{await this.app.vault.createFolder(t)}catch(e){}}getDailyFolderPath(t){let e=t.replace(/\/+$/,""),r=new Date().toISOString().split("T")[0];return`${e}/${r}`}async handleFileConflicts(t,e){let r=this.app.vault.getAbstractFileByPath(t);if(r instanceof ae.TFile)switch(await this.promptConflictResolution(r)){case"overwrite":return await this.app.vault.modify(r,e),r.path;case"new-name":return this.createVersionedCopy(r.path,e);default:throw new Error("Save cancelled by user")}return await this.app.vault.create(t,e),t}async waitForFileCreation(){return new Promise(t=>setTimeout(t,G.FILE_CREATION_WAIT))}getFileByPath(t){let e=this.app.vault.getAbstractFileByPath(t);return e instanceof ae.TFile?e:null}fileExists(t){return this.getFileByPath(t)!==null}async createUniqueFile(t,e){let r=1,i=t;for(;this.fileExists(i);){let s=t.split("/"),a=`${s.pop().replace(".md","")} (${r}).md`;i=[...s,a].join("/"),r++}return await this.app.vault.create(i,e),i}async promptConflictResolution(t){return await new oe(this.app,t).openAndWait()}async createVersionedCopy(t,e){let r=t.split("/"),s=r.pop().replace(".md",""),n=1,o;do o=[...r,`${s} (${n}).md`].join("/"),n++;while(this.fileExists(o));return await this.app.vault.create(o,e),o}normalizePath(t){if(!t)return"";let e=t.trim();for(e.startsWith("./")&&(e=e.slice(2));e.startsWith("/");)e=e.slice(1);return e=e.replace(/\/+/g,"/"),e}};var le=class extends U{constructor(e="",r,i,s){super(e,r||"qwen3-coder:480b-cloud",i);this.name="Ollama";this.ollamaEndpoint=s||"http://localhost:11434"}async process(e){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");let r={model:this._model,prompt:e,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},i=await fetch(`${this.ollamaEndpoint}/api/generate`,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(r)});if(!i.ok){if(i.status===404)throw new Error(`Ollama model not found: ${this._model}. Please make sure the model is pulled in Ollama using 'ollama pull ${this._model}'.`);if(i.status===500){let n=await this.safeJsonParse(i),o=(n==null?void 0:n.error)||"Ollama server error";throw new Error(`Ollama error: ${o}`)}throw new Error(`Ollama API error: ${i.status} - ${i.statusText}`)}let s=await i.json();if(!this.validateResponse(s,["response"]))throw new Error("Invalid response format from Ollama API");return this.extractContent(s)}catch(r){throw r instanceof Error?r.message.includes("fetch")||r.message.includes("network")||r.message.includes("ECONNREFUSED")||r.message.includes("ENOTFOUND")?new Error("Ollama server is not running or unreachable. Please ensure Ollama is installed and running on your system."):r:new Error(`Ollama processing failed: ${r}`)}}async processWithImage(e,r){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");let i=[{role:"user",content:e}];if(r&&r.length>0){let a=[];for(let d of r)if(typeof d=="string")a.push(d);else if(d instanceof ArrayBuffer){let u=new Uint8Array(d),g="";for(let v=0;v<u.length;v++)g+=String.fromCharCode(u[v]);let m=btoa(g);a.push(m)}a.length>0&&(i[0].images=a)}let s={model:this._model,messages:i,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},n=await fetch(`${this.ollamaEndpoint}/api/chat`,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(s)});if(!n.ok){if(n.status===404)throw new Error(`Ollama model not found: ${this._model}. Please make sure the model is pulled in Ollama using 'ollama pull ${this._model}'.`);if(n.status===500){let a=await this.safeJsonParse(n),d=(a==null?void 0:a.error)||"Ollama server error";throw new Error(`Ollama error: ${d}`)}throw new Error(`Ollama API error: ${n.status} - ${n.statusText}`)}let o=await n.json();if(!this.validateResponse(o,["message","content"]))throw new Error("Invalid response format from Ollama API");return this.extractContentFromChat(o)}catch(i){throw i instanceof Error?i.message.includes("fetch")||i.message.includes("network")||i.message.includes("ECONNREFUSED")||i.message.includes("ENOTFOUND")?new Error("Ollama server is not running or unreachable. Please ensure Ollama is installed and running on your system."):i:new Error(`Ollama processing failed: ${i}`)}}async checkAvailability(){try{return(await fetch(`${this.ollamaEndpoint}/api/tags`,{method:"GET",headers:this.createHeaders()})).ok}catch(e){return!1}}async checkModelAvailability(e){try{let r=await fetch(`${this.ollamaEndpoint}/api/tags`,{method:"GET",headers:this.createHeaders()});if(!r.ok)return!1;let i=await r.json();return!i||!i.models?!1:i.models.some(s=>s.name===e||s.name.startsWith(`${e}:`)||s.id&&s.id.includes(e))}catch(r){return!1}}createHeaders(){let e={"Content-Type":"application/json"};return this.apiKey&&(e.Authorization=`Bearer ${this.apiKey}`),e}createRequestBody(e){return{}}extractContent(e){return e&&typeof e=="object"&&"response"in e?e.response.trim():""}extractContentFromChat(e){return e&&typeof e=="object"&&e.message&&"content"in e.message?e.message.content.trim():""}};E();var de=class{constructor(t){this.cache=t;this.transcriptTTL=1e3*60*60}async getTranscript(t){var i,s;if(!t)throw new Error("Video ID is required");let e=`transcript-${t}`,r=(i=this.cache)==null?void 0:i.get(e);if(r)return r;try{let n=await this.fetchTranscriptWithFallback(t);return n?((s=this.cache)==null||s.set(e,n,this.transcriptTTL),n):null}catch(n){return null}}async fetchTranscriptWithFallback(t){try{let e=await this.fetchFromYouTubeAPI(t);if(e)return e}catch(e){}try{let e=await this.scrapeTranscriptFromPage(t);if(e)return e}catch(e){}try{let e=await this.fetchFromThirdParty(t);if(e)return e}catch(e){}return null}async fetchFromYouTubeAPI(t){let e=`https://video.google.com/timedtext?lang=en&v=${t}`,r=await fetch(e);if(!r.ok)throw new Error(`Transcript API failed: ${r.status}`);let i=await r.text();return this.parseXMLTranscript(i,t)}async scrapeTranscriptFromPage(t){let e=`https://www.youtube.com/watch?v=${t}`,r=`${z.CORS_PROXY}?url=${encodeURIComponent(e)}`,i=await fetch(r);if(!i.ok)throw new Error("Failed to fetch video page");let s=await i.text(),n=await this.extractTranscriptFromHTML(s);return n?this.createTranscript(n,t,!0):null}async fetchFromThirdParty(t){return null}parseXMLTranscript(t,e){let s=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("text"),n=[],o="";for(let a=0;a<s.length;a++){let d=s[a],u=d.textContent||"",g=parseFloat(d.getAttribute("start")||"0"),m=parseFloat(d.getAttribute("dur")||"0");u.trim()&&(n.push({text:u.trim(),start:g,duration:m}),o+=u.trim()+" ")}return{segments:n,fullText:o.trim(),language:"en",autoGenerated:!0}}async extractTranscriptFromHTML(t){let e=/"captions":\s*{[^}]*"playerCaptionsTracklistRenderer":\s*{[^}]*"captionTracks":\s*\[([^\]]+)\]/,r=t.match(e);if(!r||!r[1])return null;try{let i=r[1],n=JSON.parse(`[${i}]`).find(o=>{var a;return o.languageCode==="en"||((a=o.languageCode)==null?void 0:a.startsWith("en"))});return!n||!n.baseUrl?null:fetch(n.baseUrl).then(o=>{if(!o.ok)throw new Error("Failed to fetch caption track");return o.text()}).then(o=>this.parseXMLTranscript(o,"").segments).catch(o=>null)}catch(i){return null}}createTranscript(t,e,r=!1){Array.isArray(t)||(t=[t]);let i=t.map(n=>({text:n.text,start:n.start,duration:n.duration||0})),s=i.map(n=>n.text).join(" ").trim();return{segments:i,fullText:s,language:"en",autoGenerated:r}}async getTranscriptSummary(t,e=2e3){let r=await this.getTranscript(t);if(!r)return null;if(r.fullText.length<=e)return r.fullText;let i=r.segments.filter(s=>s.text.length>20).slice(0,10).map(s=>s.text).join(" ");return i.length>e?i.substring(0,e)+"...":i}async extractKeyMoments(t,e=5){let r=await this.getTranscript(t);if(!r||r.segments.length===0)return null;let i=r.segments.filter(a=>a.text.length>30);if(i.length===0)return null;let s=i.length,n=Math.max(1,Math.floor(s/e)),o=[];for(let a=0;a<s&&o.length<e;a+=n){let d=i[a];o.push({time:d.start,text:d.text})}return o}async isTranscriptAvailable(t){let e=await this.getTranscript(t);return e!==null&&e.segments.length>0}};var ue=class{constructor(t){this.cache=t;this.metadataTTL=1e3*60*30;this.descriptionTTL=1e3*60*30;this.transcriptService=new de(t)}extractVideoId(t){return h.extractVideoId(t)}async getVideoData(t){var i,s;if(!t)throw new Error("Video ID is required");let e=this.getCacheKey("video-data",t),r=(i=this.cache)==null?void 0:i.get(e);if(r)return r;try{let n=await this.getVideoMetadata(t),o={title:n.title||"Unknown Title",description:n.description||"No description available",duration:n.duration,thumbnail:n.thumbnail,channelName:n.channelName};return o.duration&&o.duration<1800&&this.checkTranscriptAvailability(t).then(a=>{var d;o.hasTranscript=a,(d=this.cache)==null||d.set(e,o,this.metadataTTL)}),(s=this.cache)==null||s.set(e,o,this.metadataTTL),o}catch(n){throw y.createUserFriendlyError(n,"fetch video data")}}async getVideoMetadata(t){var s,n;let e=this.getCacheKey("metadata",t),r=(s=this.cache)==null?void 0:s.get(e);if(r)return r;let i=`${z.YOUTUBE_OEMBED}?url=https://www.youtube.com/watch?v=${t}&format=json`;try{let o=new AbortController,a=setTimeout(()=>o.abort(),1e4),d=await fetch(i,{headers:{"User-Agent":"Obsidian YoutubeClipper Plugin"},signal:o.signal});if(clearTimeout(a),!d.ok)throw d.status===400?new Error(`Invalid YouTube video ID: ${t}. Please check the URL and try again.`):d.status===404?new Error(`YouTube video not found: ${t}. The video may be private, deleted, or the ID is incorrect.`):d.status===403?new Error(`Access denied to YouTube video: ${t}. The video may be private or restricted.`):new Error(p.ERRORS.FETCH_VIDEO_DATA(d.status));let u=await d.json(),g={title:u.title||"Unknown Title",thumbnail:u.thumbnail_url,author_name:u.author_name};try{let v=await this.scrapeAdditionalMetadata(t);g={...g,...v}}catch(v){}let m={title:g.title,description:g.description,duration:g.duration,thumbnail:g.thumbnail,channelName:g.author_name};return(n=this.cache)==null||n.set(e,m,this.metadataTTL),m}catch(o){throw o instanceof DOMException&&o.name==="AbortError"?new Error("Request timed out. Please check your internet connection and try again."):o instanceof TypeError?new Error(p.ERRORS.NETWORK_ERROR):o instanceof Error&&o.message.includes("JSON")?new Error("Failed to parse YouTube response. The service may be temporarily unavailable."):o}}async scrapeAdditionalMetadata(t){try{let e=await this.fetchVideoPageHTML(t),r=e.match(/"lengthSeconds":"(\d+)"/),i=r?parseInt(r[1]):void 0,s=e.match(/"shortDescription":"([^"]+)"/);return{description:s?s[1].replace(/\\u0026/g,"&").replace(/\\n/g,`
`):void 0,duration:i}}catch(e){return{}}}async checkTranscriptAvailability(t){try{return await this.transcriptService.isTranscriptAvailable(t)}catch(e){return!1}}async getVideoDescription(t){var i,s,n;let e=this.getCacheKey("description",t),r=(i=this.cache)==null?void 0:i.get(e);if(r)return r;try{let o=await this.fetchVideoPageHTML(t),a=this.extractDescriptionFromHTML(o);return(s=this.cache)==null||s.set(e,a,this.descriptionTTL),a}catch(o){let a=p.WARNINGS.EXTRACTION_FAILED;return(n=this.cache)==null||n.set(e,a,this.descriptionTTL),a}}async fetchVideoPageHTML(t){let e=`https://www.youtube.com/watch?v=${t}`,r=`${z.CORS_PROXY}?url=${encodeURIComponent(e)}`,i=await fetch(r);if(!i.ok)throw new Error(p.WARNINGS.CORS_RESTRICTIONS);return i.text()}extractDescriptionFromHTML(t){let e=[/"shortDescription":"([^"]*?)"/,/"description":{"simpleText":"([^"]*?)"}/,/<meta name="description" content="([^"]*?)">/,/<meta property="og:description" content="([^"]*?)">/];for(let r of e){let i=t.match(r);if(i&&i[1]){let s=h.cleanText(i[1]);return h.truncateText(s,Ue.DESCRIPTION_MAX_LENGTH)}}return p.WARNINGS.AUTO_EXTRACTION}validateAndExtractVideoId(t){if(!h.isValidYouTubeUrl(t))throw new Error(p.ERRORS.INVALID_URL);let e=this.extractVideoId(t);if(!e)throw new Error(p.ERRORS.INVALID_URL);return e}getCacheKey(t,e){return`youtube-video-service:${t}:${e}`}};var we=class{constructor(t=!0){this.startTime=Date.now();this.serviceMetrics=new Map;this.isEnabled=!0;this.isEnabled=t}trackOperation(t,e,r,i=!0,s){if(!this.isEnabled)return;let n={service:t,operation:e,duration:r,success:i,timestamp:Date.now(),metadata:s};this.serviceMetrics.has(t)||this.serviceMetrics.set(t,[]);let o=this.serviceMetrics.get(t);o.push(n),o.length>1e3&&o.splice(0,o.length-1e3),r>1e4&&console.warn(`Slow operation detected: ${t}.${e} took ${r.toFixed(2)}ms`)}async measureOperation(t,e,r,i){if(!this.isEnabled)return r();let s=performance.now(),n={value:!0};try{let o=await r();return n.value=!0,o}catch(o){throw n.value=!1,o}finally{let o=performance.now()-s;this.trackOperation(t,e,o,n.value,i)}}getServiceMetrics(t){return this.serviceMetrics.get(t)||[]}generateReport(){let t={timestamp:new Date().toISOString(),uptime:Date.now()-this.startTime,services:{},systemMetrics:{},recommendations:[]};return this.serviceMetrics.forEach((e,r)=>{if(e.length===0)return;let i=e.filter(a=>a.success),s=e.filter(a=>!a.success),n=e.map(a=>a.duration),o={totalOperations:e.length,averageResponseTime:n.reduce((a,d)=>a+d,0)/n.length,successRate:i.length/e.length,errorCount:s.length,slowestOperation:this.findExtremeOperation(e,"slowest"),fastestOperation:this.findExtremeOperation(e,"fastest")};t.services[r]=o}),t.systemMetrics={memoryUsage:this.getMemoryUsage(),cacheHitRate:this.getCacheHitRate(),httpMetrics:this.getHTTPMetrics()},t.recommendations=this.generateRecommendations(t),t}findExtremeOperation(t,e){if(t.length===0)return{name:"none",duration:0};let i=[...t].sort((s,n)=>e==="slowest"?n.duration-s.duration:s.duration-n.duration)[0];return{name:`${i.operation}${i.metadata?` (${JSON.stringify(i.metadata)})`:""}`,duration:i.duration}}getMemoryUsage(){if(performance.memory)return Math.round(performance.memory.usedJSHeapSize/1024/1024)}getCacheHitRate(){}getHTTPMetrics(){}generateRecommendations(t){let e=[];return Object.entries(t.services).forEach(([r,i])=>{i.averageResponseTime>5e3&&e.push(`${r} average response time exceeds 5 seconds (${i.averageResponseTime.toFixed(0)}ms)`),i.successRate<.95&&e.push(`${r} success rate below 95% (${(i.successRate*100).toFixed(1)}%)`),i.errorCount>i.totalOperations*.1&&e.push(`${r} error rate is high (${i.errorCount}/${i.totalOperations})`)}),t.systemMetrics.memoryUsage&&t.systemMetrics.memoryUsage>100&&e.push("High memory usage detected - consider implementing more aggressive cleanup"),t.uptime>24*60*60*1e3&&e.push("Plugin has been running for over 24 hours - consider restarting Obsidian"),e}exportMetrics(){return JSON.stringify({timestamp:new Date().toISOString(),uptime:Date.now()-this.startTime,services:Object.fromEntries(this.serviceMetrics),systemInfo:{userAgent:navigator.userAgent,platform:navigator.platform,memory:performance.memory?{used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit}:void 0}},null,2)}clearMetrics(){this.serviceMetrics.clear()}setEnabled(t){this.isEnabled=t}isTrackingEnabled(){return this.isEnabled}getUptime(){let t=Date.now()-this.startTime,e=Math.floor(t/(1e3*60*60)),r=Math.floor(t%(1e3*60*60)/(1e3*60)),i=Math.floor(t%(1e3*60)/1e3);return e>0?`${e}h ${r}m ${i}s`:r>0?`${r}m ${i}s`:`${i}s`}},K=new we;var W=class{constructor(t,e){this.settings=t;this.app=e;this.serviceMetrics=new Map;this.SERVICE_TTL=5*60*1e3;this.setupPeriodicCleanup(),this.trackMemoryUsage()}get aiService(){return this.getService("aiService",()=>{let t=performance.now(),e=[];this.settings.geminiApiKey&&e.push(new ie(this.settings.geminiApiKey)),this.settings.groqApiKey&&e.push(new se(this.settings.groqApiKey)),e.push(new le(this.settings.ollamaApiKey||""));let r=new re(e,this.settings);return this.recordServiceMetrics("aiService",performance.now()-t),r})}get videoService(){return this.getService("videoService",()=>{let t=performance.now(),e=new ue(this.cacheService);return this.recordServiceMetrics("videoService",performance.now()-t),e})}get fileService(){return this.getService("fileService",()=>{let t=performance.now(),e=new ce(this.app);return this.recordServiceMetrics("fileService",performance.now()-t),e})}get cacheService(){return this.getService("cacheService",()=>{let t=performance.now(),e=new ne;return this.recordServiceMetrics("cacheService",performance.now()-t),e})}get promptService(){return this.getService("promptService",()=>{let t=performance.now(),e=new ee;return this.recordServiceMetrics("promptService",performance.now()-t),e})}getService(t,e){let r=`_${t}`,i=this[r];if(i){let o=this.serviceMetrics.get(t);return o&&(o.lastUsed=Date.now(),o.usageCount++),i}let s=performance.now(),n=e();return this[r]=n,K.trackOperation("ServiceContainer",`getService-${t}`,performance.now()-s,!0,{serviceName:t}),n}recordServiceMetrics(t,e){this.serviceMetrics.set(t,{creationTime:e,lastUsed:Date.now(),usageCount:0})}setupPeriodicCleanup(){this.cleanupInterval=setInterval(()=>{this.performCleanup()},2*60*1e3)}performCleanup(){let t=Date.now(),e=[];this.serviceMetrics.forEach((r,i)=>{t-r.lastUsed>this.SERVICE_TTL&&e.push(i)}),e.forEach(r=>{this.clearService(r),this.serviceMetrics.delete(r)}),this.isMemoryUsageHigh()&&this.performAggressiveCleanup()}clearService(t){let e=`_${t}`,r=this[e];if(r&&typeof r.cleanup=="function")try{r.cleanup()}catch(i){console.warn(`Error during cleanup of ${t}:`,i)}this[e]=void 0}isMemoryUsageHigh(){if(performance.memory){let t=performance.memory.usedJSHeapSize,e=performance.memory.jsHeapSizeLimit;return t/e>.8}return!1}performAggressiveCleanup(){console.warn("High memory usage detected, performing aggressive cleanup");let t=Array.from(this.serviceMetrics.entries()).sort((r,i)=>i[1].lastUsed-r[1].lastUsed),[e]=t;this.serviceMetrics.forEach((r,i)=>{i!==(e==null?void 0:e[0])&&this.clearService(i)}),this.serviceMetrics.clear(),e&&this.serviceMetrics.set(e[0],e[1]),window.gc&&window.gc()}trackMemoryUsage(){setInterval(()=>{if(performance.memory){let t=performance.memory,e=Math.round(t.usedJSHeapSize/1024/1024),r=Math.round(t.jsHeapSizeLimit/1024/1024);e>50&&console.debug(`Memory usage: ${e}MB / ${r}MB`)}},60*1e3)}async updateSettings(t){this.settings=t,this.clearService("aiService"),this.serviceMetrics.delete("aiService"),this.clearService("videoService"),this.serviceMetrics.delete("videoService")}clearServices(){Object.keys(this.serviceMetrics).forEach(t=>{this.clearService(t)}),this._aiService=void 0,this._videoService=void 0,this._fileService=void 0,this._cacheService=void 0,this._promptService=void 0,this.serviceMetrics.clear()}getServiceMetrics(){let t={};return this.serviceMetrics.forEach((e,r)=>{t[r]={...e}}),t}getPerformanceReport(){let t=this.getServiceMetrics(),e=K.generateReport(),r=this._aiService;r&&typeof r.getPerformanceMetrics=="function"&&(e.services.aiService={...e.services.aiService,...r.getPerformanceMetrics()});let i=this._videoService;i&&typeof i.getPerformanceMetrics=="function"&&(e.services.videoService={...e.services.videoService,...i.getPerformanceMetrics()});let s=this._cacheService;return s&&typeof s.getMetrics=="function"&&(e.systemMetrics.cacheMetrics=s.getMetrics()),{...e,containerMetrics:{uptime:K.getUptime(),services:Object.keys(t),memoryUsage:this.isMemoryUsageHigh()}}}cleanup(){this.cleanupInterval&&clearInterval(this.cleanupInterval),this._aiService&&typeof this._aiService.cleanup=="function"&&this._aiService.cleanup(),this._videoService&&typeof this._videoService.cleanup=="function"&&this._videoService.cleanup(),this._cacheService&&typeof this._cacheService.destroy=="function"&&this._cacheService.destroy(),this.clearServices(),K.clearMetrics()}};var qe=require("obsidian");var me=class{constructor(t,e,r,i={noteMarker:"<!-- ytc-extension:youtube-clipper -->",urlHandlerDelay:500,maxHandledFiles:100,tempFileAgeThreshold:5e3}){this.app=t;this.settings=e;this.onUrlDetected=r;this.config=i;this.handledTempFiles=new Set;this.pendingUrls=new Map}isTempFile(t,e){try{if(e&&e.includes(this.config.noteMarker))return c.debug("File identified as temp file via marker","UrlHandler",{filePath:t.path,hasMarker:!0}),!0;if(t.name&&t.name.startsWith("YouTube Clip -"))return c.debug("File identified as temp file via name","UrlHandler",{filePath:t.path,fileName:t.name}),!0;let i=e.trim().split(`
`).filter(n=>n.trim().length>0);if(i.length===1&&h.isValidYouTubeUrl(i[0])&&e.length<200){let n=Date.now()-t.stat.ctime,o=t.path.includes(this.settings.outputPath);if(n<this.config.tempFileAgeThreshold&&!o)return c.debug("File identified as temp file via content analysis","UrlHandler",{filePath:t.path,fileAge:n,isInOutputPath:o,contentLength:e.length}),!0}return!1}catch(r){return c.error("Error checking if file is temp file","UrlHandler",{filePath:t.path,error:r instanceof Error?r.message:String(r)}),!1}}extractUrl(t){try{if(t&&t.includes(this.config.noteMarker)){let s=t.replace(this.config.noteMarker,"").trim();return h.isValidYouTubeUrl(s)?s:null}let e=t.trim(),r=/(https?:\/\/(?:www\.)?youtube\.com\/watch\?v=[A-Za-z0-9_-]{6,}|https?:\/\/(?:www\.)?youtu\.be\/[A-Za-z0-9_-]{6,})/i,i=e.match(r);if(i&&i[1]){let s=i[1].trim();return h.isValidYouTubeUrl(s)?s:null}return null}catch(e){return c.error("Error extracting URL from content","UrlHandler",{error:e instanceof Error?e.message:String(e),contentLength:t.length}),null}}handleUrlSafely(t){if(c.info("URL detected, processing safely","UrlHandler",{url:t.url,source:t.source,filePath:t.filePath}),t.file&&t.content&&!this.isTempFile(t.file,t.content)){c.warn("URL rejected - not in temp file","UrlHandler",{url:t.url,filePath:t.filePath});return}if(this.handledTempFiles.has(t.url)){c.debug("URL already handled, skipping","UrlHandler",{url:t.url});return}this.pendingUrls.has(t.url)&&(c.debug("Cancelling pending handler for URL","UrlHandler",{url:t.url}),clearTimeout(this.pendingUrls.get(t.url))),this.handledTempFiles.add(t.url),t.filePath&&this.handledTempFiles.add(t.filePath);let e=setTimeout(()=>{c.info("Processing URL after debounce","UrlHandler",{url:t.url}),this.onUrlDetected(t),this.pendingUrls.delete(t.url),this.cleanupHandledFiles()},this.config.urlHandlerDelay);this.pendingUrls.set(t.url,e)}cleanupHandledFiles(){if(this.handledTempFiles.size>this.config.maxHandledFiles){let t=Array.from(this.handledTempFiles);this.handledTempFiles.clear(),t.slice(-Math.floor(this.config.maxHandledFiles/2)).forEach(e=>{this.handledTempFiles.add(e)}),c.debug("Cleaned up handled temp files","UrlHandler",{oldSize:t.length,newSize:this.handledTempFiles.size})}}async handleFileCreate(t){try{if(!(t instanceof qe.TFile))return;let e=await this.app.vault.read(t);if(!this.isTempFile(t,e)){c.debug("Ignoring non-temp file in create handler","UrlHandler",{filePath:t.path});return}let r=this.extractUrl(e);if(!r){c.debug("No URL extracted from temp file","UrlHandler",{filePath:t.path});return}let i={url:r,source:"create",filePath:t.path,file:t,content:e};c.info("CREATE EVENT - detected temp note","UrlHandler",i),this.handleUrlSafely(i)}catch(e){c.error("Error handling file create","UrlHandler",{filePath:t.path,error:e instanceof Error?e.message:String(e)})}}async handleActiveLeafChange(){try{let t=this.app.workspace.getActiveFile();if(!t||!("stat"in t)||!("basename"in t)||!("extension"in t)||this.handledTempFiles.has(t.path))return;let e=await this.app.vault.read(t);if(!this.isTempFile(t,e)){c.debug("Ignoring non-temp file in active leaf handler","UrlHandler",{filePath:t.path});return}let r=this.extractUrl(e);if(!r){c.debug("No URL extracted from temp file in active leaf","UrlHandler",{filePath:t.path});return}let i={url:r,source:"active-leaf",filePath:t.path,file:t,content:e};c.info("ACTIVE-LEAF-CHANGE EVENT - detected temp note","UrlHandler",i),this.handleUrlSafely(i)}catch(t){c.error("Error handling active leaf change","UrlHandler",{error:t instanceof Error?t.message:String(t)})}}handleProtocol(t){try{let e=t.url||t.content||t.path||"";if(e&&h.isValidYouTubeUrl(e)){let r={url:e,source:"protocol"};c.info("Protocol handler received valid URL","UrlHandler",r),setTimeout(()=>{this.onUrlDetected(r)},200)}else c.debug("Protocol handler received no valid URL","UrlHandler",{params:t})}catch(e){c.error("Error in protocol handler","UrlHandler",{params:t,error:e instanceof Error?e.message:String(e)})}}async handleClipboardUrl(){try{let t="";try{navigator&&navigator.clipboard&&navigator.clipboard.readText&&(t=await navigator.clipboard.readText()||"")}catch(e){c.debug("Could not read clipboard","UrlHandler",{error:e instanceof Error?e.message:String(e)}),t=""}if(t&&h.isValidYouTubeUrl(t.trim())){let e={url:t.trim(),source:"clipboard"};c.info("URL found in clipboard","UrlHandler",e),this.onUrlDetected(e);return}c.debug("No valid YouTube URL in clipboard","UrlHandler")}catch(t){c.error("Error handling clipboard URL","UrlHandler",{error:t instanceof Error?t.message:String(t)})}}clear(){this.pendingUrls.forEach(t=>clearTimeout(t)),this.pendingUrls.clear(),this.handledTempFiles.clear(),c.info("URL handler cleared","UrlHandler")}updateSettings(t){this.settings=t,c.debug("URL handler settings updated","UrlHandler")}};var pe=class{constructor(t){this.settings=t}getApiKey(t){return this.settings.useEnvironmentVariables?this.getFromEnvironment(t):t==="gemini"?this.settings.geminiApiKey:this.settings.groqApiKey}getFromEnvironment(t){let r=`${this.settings.environmentPrefix||"YTC"}_${t.toUpperCase()}_API_KEY`;return this.getSecureEnvVar(r)||""}getSecureEnvVar(t){return typeof process!="undefined"&&process.env?process.env[t]:this.getFromSecureStorage(t)}getFromSecureStorage(t){}validateSecurityConfiguration(){let t=[],e=!0;return this.settings.useEnvironmentVariables||(this.settings.geminiApiKey&&this.settings.geminiApiKey.length>0&&(t.push("Gemini API key is stored directly in configuration. Consider using environment variables."),e=!1),this.settings.groqApiKey&&this.settings.groqApiKey.length>0&&(t.push("Groq API key is stored directly in configuration. Consider using environment variables."),e=!1)),(this.settings.geminiApiKey==="your-api-key-here"||this.settings.groqApiKey==="your-api-key-here")&&(t.push("Default placeholder API keys detected. Please set real API keys."),e=!1),{isSecure:e,warnings:t}}getEnvironmentTemplate(){let t=this.settings.environmentPrefix||"YTC";return`# YouTubeClipper Environment Variables
# Set these in your environment for secure API key management

# Google Gemini API Key
${t}_GEMINI_API_KEY=your_gemini_api_key_here

# Groq API Key  
${t}_GROQ_API_KEY=your_groq_api_key_here

# Usage:
# 1. Set these variables in your shell profile (.bashrc, .zshrc, etc.)
# 2. Enable "Use Environment Variables" in plugin settings
# 3. Restart Obsidian to pick up the new environment variables
`}};var C=require("obsidian"),R={container:"ytc-settings-container",section:"ytc-settings-section",header:"ytc-settings-header",validation:"ytc-settings-validation"},he=class extends C.PluginSettingTab{constructor(e,r){super(e,r.plugin);this.options=r;this.validationErrors=[];this.settings={...r.plugin.settings},this.secureConfig=new pe(this.settings)}display(){let{containerEl:e}=this;e.empty(),e.addClass(R.container),e.setAttribute("data-plugin","youtube-clipper"),e.style.overflowY="auto",e.style.maxHeight="80vh",e.style.height="fit-content",e.style.paddingRight="8px",e.style.margin="0",e.style.padding="8px",this.addScrollbarStyling(),this.createImprovedCompactLayout()}addScrollbarStyling(){if(document.getElementById("ytc-scrollbar-styles"))return;let e=document.createElement("style");e.id="ytc-scrollbar-styles",e.textContent=`
            .${R.container}::-webkit-scrollbar {
                width: 8px;
            }

            .${R.container}::-webkit-scrollbar-track {
                background: var(--background-primary);
                border-radius: 4px;
            }

            .${R.container}::-webkit-scrollbar-thumb {
                background: var(--background-modifier-border);
                border-radius: 4px;
            }

            .${R.container}::-webkit-scrollbar-thumb:hover {
                background: var(--interactive-accent);
            }
        `,document.head.appendChild(e)}createImprovedCompactLayout(){this.addCompactStyles();let{containerEl:e}=this;e.style.display="flex",e.style.flexDirection="column",e.style.height="fit-content",e.style.gap="8px",e.style.padding="8px",e.style.overflow="visible",e.style.backgroundColor="var(--background-primary)",this.createCompactHeader();let r=e.createDiv();r.style.display="flex",r.style.flexDirection="column",r.style.gap="8px",r.style.width="100%",this.createAPISettingsSection(r),this.createAIParametersSection(r),this.createFileSettingsSection(r),this.createAdvancedSettingsSection(r),this.createQuickStartSection(r)}addCompactStyles(){if(document.getElementById("ytc-compact-styles"))return;let e=document.createElement("style");e.id="ytc-compact-styles",e.textContent=`
            .${R.container} .setting-item {
                padding: 6px 4px !important;
                margin: 2px 0 !important;
            }
            .${R.container} .setting-item-name {
                font-size: 0.85rem !important;
                margin-bottom: 1px !important;
            }
            .${R.container} .setting-item-description {
                font-size: 0.75rem !important;
                margin-bottom: 2px !important;
            }
            .${R.container} input[type="text"] {
                font-size: 0.8rem !important;
                padding: 4px 6px !important;
            }
            .${R.container} select {
                font-size: 0.8rem !important;
                padding: 4px 6px !important;
            }
            .${R.container} button {
                font-size: 0.75rem !important;
                padding: 3px 8px !important;
            }
        `,document.head.appendChild(e)}createCompactHeader(){let{containerEl:e}=this,r=e.createDiv();r.style.cssText=`
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 10px;
            background: var(--background-secondary);
            border-radius: 5px;
            border: 1px solid var(--background-modifier-border);
            margin-bottom: 6px;
        `;let i=r.createEl("h2",{text:"YT Clipper Settings",style:"margin: 0; font-size: 1rem; font-weight: 600; color: var(--text-normal);"}),s=this.validateConfiguration(),n=r.createDiv();n.style.cssText=`
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        `,s?(n.style.background="var(--interactive-accent)",n.style.color="var(--text-on-accent)",n.textContent="\u2713 Ready"):(n.style.background="var(--text-warning)",n.style.color="var(--text-on-accent)",n.textContent="\u26A0 Setup Needed")}createAPISettingsSection(e){let r=e.createDiv();r.style.background="var(--background-secondary)",r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="6px",r.style.padding="6px",r.style.display="flex",r.style.flexDirection="column",r.style.gap="4px";let i=r.createEl("h3",{text:"\u{1F511} API",style:"margin: 0 0 3px 0; font-size: 0.85rem; font-weight: 600; color: var(--text-normal);"});new C.Setting(r).setName("Gemi").setDesc("Key").addText(n=>n.setPlaceholder("AIza...").setValue(this.settings.geminiApiKey||"").onChange(async o=>{await this.updateSetting("geminiApiKey",o)})).setClass("compact-setting"),new C.Setting(r).setName("Groq").setDesc("Key").addText(n=>n.setPlaceholder("gsk_...").setValue(this.settings.groqApiKey||"").onChange(async o=>{await this.updateSetting("groqApiKey",o)})).setClass("compact-setting"),new C.Setting(r).setName("Ollm").setDesc("Key").addText(n=>n.setPlaceholder("key").setValue(this.settings.ollamaApiKey||"").onChange(async o=>{await this.updateSetting("ollamaApiKey",o)})).setClass("compact-setting");let s=r.createDiv();s.style.marginTop="2px",new C.Setting(s).setName("Test").setDesc("").addButton(n=>n.setButtonText("\u2713").onClick(async()=>{n.setDisabled(!0),n.setButtonText("...");try{await this.testAPIKeys(),n.setButtonText("\u2713"),setTimeout(()=>{n.setButtonText("\u2713"),n.setDisabled(!1)},1500)}catch(o){n.setButtonText("\u2717"),y.handle(o,"API key test failed",!0),setTimeout(()=>{n.setButtonText("\u2713"),n.setDisabled(!1)},1500)}})).setClass("compact-setting")}createAIParametersSection(e){let r=e.createDiv();r.style.background="var(--background-secondary)",r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="6px",r.style.padding="6px",r.style.display="flex",r.style.flexDirection="column",r.style.gap="4px";let i=r.createEl("h3",{text:"\u2699\uFE0F AI",style:"margin: 0 0 3px 0; font-size: 0.85rem; font-weight: 600; color: var(--text-normal);"}),s=document.createElement("style");s.textContent=`
            .ytc-slider {
                width: 100% !important;
                height: 5px !important; /* Even thinner for compactness */
                border-radius: 2px !important;
                background: var(--interactive-normal) !important;
                outline: none !important;
                -webkit-appearance: none !important;
                appearance: none !important;
                cursor: pointer !important;
            }
            .ytc-slider:hover {
                background: var(--interactive-hover) !important;
            }
            .ytc-slider::-webkit-slider-thumb {
                -webkit-appearance: none !important;
                appearance: none !important;
                width: 14px !important; /* Smaller thumb */
                height: 14px !important;
                background: var(--interactive-accent) !important;
                border-radius: 50% !important;
                cursor: pointer !important;
                border: 1px solid var(--text-on-accent) !important;
                box-shadow: 0 1px 2px rgba(0,0,0,0.2) !important;
            }
            .ytc-slider::-moz-range-thumb {
                width: 14px !important;
                height: 14px !important;
                background: var(--interactive-accent) !important;
                border-radius: 50% !important;
                cursor: pointer !important;
                border: 1px solid var(--text-on-accent) !important;
                box-shadow: 0 1px 2px rgba(0,0,0,0.2) !important;
            }
        `,document.head.appendChild(s);let n=(a,d,u,g,m,v)=>{let f=r.createDiv();f.style.marginBottom="4px";let b=f.createDiv();b.style.display="flex",b.style.justifyContent="space-between",b.style.alignItems="center",b.style.marginBottom="2px";let B=b.createSpan();B.textContent=a,B.style.fontSize="0.75rem",B.style.fontWeight="500",B.style.color="var(--text-normal)";let x=b.createSpan();x.textContent=m.toString(),x.style.fontSize="0.7rem",x.style.fontWeight="600",x.style.color="var(--interactive-accent)",x.style.padding="1px 3px",x.style.background="var(--background-primary)",x.style.borderRadius="2px",x.style.border="1px solid var(--interactive-accent)";let T=f.createEl("input",{type:"range"});return T.className="ytc-slider",T.min=d.toString(),T.max=u.toString(),T.step=g.toString(),T.value=m.toString(),T.addEventListener("input",()=>{x.textContent=v==="defaultTemperature"?parseFloat(T.value).toFixed(1):T.value}),T.addEventListener("change",async()=>{let H=v==="defaultTemperature"?parseFloat(T.value):parseInt(T.value);await this.updateSetting(v,H)}),f};n("Tokens",256,8192,256,this.settings.defaultMaxTokens||4096,"defaultMaxTokens"),n("Temp",0,2,.1,this.settings.defaultTemperature||.5,"defaultTemperature");let o=r.createDiv();o.style.display="flex",o.style.justifyContent="space-between",o.style.fontSize="0.6rem",o.style.color="var(--text-muted)",o.style.marginTop="-4px",o.style.padding="0 1px",o.createSpan({text:"P"}),o.createSpan({text:"C"}),new C.Setting(r).setName("Perf").setDesc("Mode").addDropdown(a=>a.addOption("fast","F").addOption("balanced","B").addOption("quality","Q").setValue(this.settings.performanceMode||"balanced").onChange(async d=>{await this.updateSetting("performanceMode",d)})).setClass("compact-setting")}createAdvancedSettingsSection(e){let r=e.createDiv();r.style.background="var(--background-secondary)",r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="6px",r.style.padding="6px",r.style.display="flex",r.style.flexDirection="column",r.style.gap="3px";let i=r.createEl("h3",{text:"\u2699\uFE0F Adv",style:"margin: 0 0 2px 0; font-size: 0.85rem; font-weight: 600; color: var(--text-normal);"});new C.Setting(r).setName("Parallel").setDesc("Multi").addToggle(s=>s.setValue(this.settings.enableParallelProcessing||!1).onChange(async n=>{await this.updateSetting("enableParallelProcessing",n)})).setClass("compact-setting"),new C.Setting(r).setName("MM-Audio").setDesc("Vid").addToggle(s=>s.setValue(this.settings.preferMultimodal||!1).onChange(async n=>{await this.updateSetting("preferMultimodal",n)})).setClass("compact-setting")}createFileSettingsSection(e){let r=e.createDiv();r.style.background="var(--background-secondary)",r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="6px",r.style.padding="6px",r.style.display="flex",r.style.flexDirection="column",r.style.gap="4px";let i=r.createEl("h3",{text:"\u{1F4C1} Files",style:"margin: 0 0 2px 0; font-size: 0.85rem; font-weight: 600; color: var(--text-normal);"});new C.Setting(r).setName("Path").setDesc("Out").addText(s=>s.setPlaceholder("YT/Proc").setValue(this.settings.outputPath||"YouTube/Processed Videos").onChange(async n=>{await this.updateSetting("outputPath",n)})).setClass("compact-setting")}validateConfiguration(){var i,s;let e=((i=this.settings.geminiApiKey)==null?void 0:i.trim())||((s=this.settings.groqApiKey)==null?void 0:s.trim()),r=h.isValidPath(this.settings.outputPath);return!!(e&&r)}showDocumentation(){window.open("https://github.com/youtube-clipper/obsidian-plugin#readme","_blank")}createQuickStartSection(e){let r=e.createDiv();r.style.background="var(--background-secondary)",r.style.border="1px solid var(--background-modifier-border)",r.style.borderRadius="6px",r.style.padding="6px",r.style.display="flex",r.style.flexDirection="column",r.style.gap="3px";let i=r.createEl("h3",{text:"\u{1F680} Go",style:"margin: 0 0 2px 0; font-size: 0.8rem; font-weight: 600; color: var(--text-normal);"}),s=r.createDiv();s.style.fontSize="0.7rem",s.style.lineHeight="1.2",["API (G/G)","Cfg","URL","Go"].forEach((g,m)=>{let v=s.createDiv();v.style.marginBottom="2px",v.style.display="flex",v.style.alignItems="flex-start",v.style.gap="3px";let f=v.createSpan();f.textContent=m+1+".",f.style.color="var(--interactive-accent)",f.style.fontWeight="600",f.style.minWidth="10px";let b=v.createSpan();b.textContent=g});let o=r.createDiv();o.style.marginTop="3px",o.style.paddingTop="3px",o.style.borderTop="1px solid var(--background-modifier-border)",o.style.fontSize="0.65rem",o.style.color="var(--text-muted)";let a=o.createSpan();a.textContent="Keys: ",a.style.fontWeight="500";let d=o.createEl("a",{text:"G",href:"https://aistudio.google.com/app/apikey",cls:"external-link"});d.style.marginRight="5px",d.style.color="var(--link-color)",d.style.fontSize="0.65rem";let u=o.createEl("a",{text:"Gr",href:"https://console.groq.com/keys",cls:"external-link"});u.style.color="var(--link-color)",u.style.fontSize="0.65rem"}async testAPIKeys(){let e=[];if(this.settings.geminiApiKey)try{let r=await fetch("https://generativelanguage.googleapis.com/v1beta/models?key="+this.settings.geminiApiKey);r.ok||e.push(`Gemini API key invalid (${r.status})`)}catch(r){e.push("Gemini API key test failed (network error)")}else e.push("Gemini API key not configured");if(e.length>0)throw new Error(e.join(`
`))}async updateSetting(e,r){try{this.settings[e]=r,await this.validateAndSaveSettings()}catch(i){y.handle(i,`Settings update for ${e}`)}}async validateAndSaveSettings(){let e=h.validateSettings(this.settings);this.validationErrors=e.errors,e.isValid&&await this.options.onSettingsChange(this.settings),this.display()}getSettings(){return{...this.settings}}updateSettings(e){this.settings={...e},this.display()}};N();E();var F=class{static loadPreferences(){try{let t=localStorage.getItem(this.STORAGE_KEY);if(t){let e=JSON.parse(t);return{...this.DEFAULT_PREFERENCES,...e}}}catch(t){}return{...this.DEFAULT_PREFERENCES}}static savePreferences(t){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){}}static getPreference(t){return this.loadPreferences()[t]}static setPreference(t,e){let r=this.loadPreferences();r[t]=e,this.savePreferences(r)}static updateLastUsed(t){let e=this.loadPreferences();t.format&&(e.lastFormat=t.format,e.formatUsage[t.format]=(e.formatUsage[t.format]||0)+1),t.provider&&(e.lastProvider=t.provider,e.providerUsage[t.provider]=(e.providerUsage[t.provider]||0)+1),t.model&&(e.lastModel=t.model),t.maxTokens&&(e.lastMaxTokens=t.maxTokens),t.temperature&&(e.lastTemperature=t.temperature),t.performanceMode&&(e.lastPerformanceMode=t.performanceMode),t.parallelProcessing!==void 0&&(e.lastParallelProcessing=t.parallelProcessing),t.multimodal!==void 0&&(e.lastMultimodal=t.multimodal),e.lastUsed=new Date().toISOString(),e.totalProcessed=(e.totalProcessed||0)+1,this.savePreferences(e)}static getSmartDefaultFormat(){let t=this.loadPreferences();if(t.preferredFormat)return t.preferredFormat;let e=t.formatUsage||{},r=0,i="executive-summary";for(let[s,n]of Object.entries(e))n>r&&(r=n,i=s);return i}static getSmartDefaultProvider(){let t=this.loadPreferences();if(t.preferredProvider)return t.preferredProvider;let e=t.providerUsage||{},r=0,i;for(let[s,n]of Object.entries(e))n>r&&(r=n,i=s);return i}static getSmartDefaultModelParameters(){let t=this.loadPreferences();return{maxTokens:t.lastMaxTokens||4096,temperature:t.lastTemperature||.5}}static getSmartDefaultPerformanceSettings(){let t=this.loadPreferences();return{mode:t.lastPerformanceMode||"balanced",parallel:t.lastParallelProcessing||!1,multimodal:t.lastMultimodal||!0}}static getUserInsights(){let t=this.loadPreferences(),e=t.formatUsage||{},r=t.providerUsage||{},i="executive-summary",s=0;for(let[g,m]of Object.entries(e))m>s&&(s=m,i=g);let n="",o=0;for(let[g,m]of Object.entries(r))m>o&&(o=m,n=g);let a=t.totalProcessed||0,d=a<5?"light":a<20?"moderate":"heavy",u=[];return d==="heavy"&&!t.showAdvancedSettings&&u.push("Consider enabling advanced settings for more control"),!t.autoSelectProvider&&Object.keys(r).length>1&&u.push("Enable auto-select provider to speed up your workflow"),!t.showPreview&&a>10&&u.push("Enable video preview for better context"),{favoriteFormat:i,favoriteProvider:n,averageTokens:t.lastMaxTokens||4096,averageTemperature:t.lastTemperature||.5,usageLevel:d,recommendations:u}}static resetPreferences(){localStorage.removeItem(this.STORAGE_KEY)}static exportPreferences(){let t=this.loadPreferences();return JSON.stringify(t,null,2)}static importPreferences(t){try{let e=JSON.parse(t);return this.savePreferences({...this.DEFAULT_PREFERENCES,...e}),!0}catch(e){return!1}}};F.STORAGE_KEY="yt-clipper-user-preferences",F.DEFAULT_PREFERENCES={autoSelectProvider:!0,showPreview:!0,enableKeyboardShortcuts:!0,enableAnimations:!0,autoFocusUrl:!0,showAdvancedSettings:!1,compactMode:!1,formatUsage:{brief:0,"executive-summary":0,"detailed-guide":0,custom:0},providerUsage:{}};var O=require("obsidian"),ge=class extends A{constructor(e,r){super(e);this.options=r;this.url="";this.format="executive-summary";this.fetchInProgress=!1;this.progressSteps=[];this.currentStepIndex=0;this.isProcessing=!1;this.isLightTheme=!1;this.url=r.initialUrl||"";let i=localStorage.getItem("ytc-theme-mode");this.isLightTheme=i==="light";let s=F.getSmartDefaultPerformanceSettings(),n=F.getSmartDefaultModelParameters();this.selectedProvider="Google Gemini",this.selectedModel="gemini-2.5-pro",F.updateLastUsed({format:"detailed-guide",provider:this.selectedProvider,model:this.selectedModel,maxTokens:r.defaultMaxTokens||4096,temperature:r.defaultTemperature||.5,performanceMode:s.mode,parallelProcessing:s.parallel,multimodal:s.multimodal})}onOpen(){if(console.log("[YT-CLIPPER] YouTubeUrlModal.onOpen called"),this.createModalContent(),this.setupEventHandlers(),this.setupKeyboardShortcuts(),this.options.initialUrl&&(this.setUrl(this.options.initialUrl),this.updateProcessButtonState(),h.isValidYouTubeUrl((this.options.initialUrl||"").trim())&&this.processButton)){this.processButton.focus();return}this.focusUrlInput()}createModalContent(){this.headerEl=this.createHeader(p.MODALS.PROCESS_VIDEO),this.createThemeToggle(),this.createCompactUrlSection(),this.createDropDownRow(),this.createProgressSection(),this.createActionButtons()}createCompactUrlSection(){let e=this.contentEl.createDiv();e.style.cssText=`
            margin: 16px 0;
            position: relative;
        `;let r=e.createDiv();r.style.cssText=`
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        `,this.urlInput=r.createEl("input"),this.urlInput.type="url",this.urlInput.placeholder="Paste YouTube URL here...",this.urlInput.style.cssText=`
            flex: 1;
            padding: 12px;
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            font-size: 0.9rem;
            background: var(--background-primary);
            color: var(--text-normal);
            transition: all 0.2s ease;
            outline: none;
        `,this.pasteButton=r.createEl("button"),this.pasteButton.innerHTML="\u{1F4CB}",this.pasteButton.style.cssText=`
            padding: 8px 12px;
            background: var(--interactive-accent);
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            color: white;
        `,this.pasteButton.addEventListener("click",()=>this.handleSmartPaste()),this.pasteButton.addEventListener("mouseenter",()=>{this.pasteButton.style.background="var(--interactive-accent-hover)"}),this.pasteButton.addEventListener("mouseleave",()=>{this.pasteButton.style.background="var(--interactive-accent)"}),this.urlInput.addEventListener("focus",()=>{this.urlInput.style.borderColor="var(--interactive-accent)",this.urlInput.style.boxShadow="0 0 0 2px rgba(99, 102, 241, 0.2)"}),this.urlInput.addEventListener("blur",()=>{this.urlInput.style.borderColor="var(--background-modifier-border)",this.urlInput.style.boxShadow="none"}),this.validationMessage=e.createDiv(),this.validationMessage.style.cssText=`
            margin-top: 6px;
            padding: 6px;
            font-size: 0.8rem;
            color: var(--text-muted);
            border-radius: 4px;
        `}createDropDownRow(){let e=this.contentEl.createDiv();e.style.cssText=`
            display: flex;
            gap: 10px;
            margin: 12px 0;
        `;let r=e.createDiv();r.style.cssText=`
            flex: 1;
        `;let i=r.createDiv();i.textContent="Format",i.style.cssText=`
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-normal);
            font-size: 0.9rem;
        `,this.formatSelect=r.createEl("select"),this.formatSelect.style.cssText=`
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            font-size: 0.9rem;
            background: var(--background-primary);
            color: var(--text-normal);
            cursor: pointer;
            outline: none;
            transition: all 0.2s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            min-height: 40px;
        `,[{value:"executive-summary",text:"1. Executive"},{value:"detailed-guide",text:"2. Comprehensive"},{value:"brief",text:"3. Brief"},{value:"custom",text:"4. Custom"}].forEach(f=>{let b=this.formatSelect.createEl("option");b.value=f.value,b.textContent=f.text}),this.formatSelect.value="executive-summary",this.formatSelect.addEventListener("change",()=>{this.format=this.formatSelect.value});let n=e.createDiv();n.style.cssText=`
            flex: 1;
        `;let o=n.createDiv();o.textContent="Provider",o.style.cssText=`
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-normal);
            font-size: 0.9rem;
        `,this.providerSelect=n.createEl("select"),this.providerSelect.style.cssText=`
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            font-size: 0.9rem;
            background: var(--background-primary);
            color: var(--text-normal);
            cursor: pointer;
            outline: none;
            transition: all 0.2s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            min-height: 40px;
        `,[{value:"Google Gemini",text:"Google"},{value:"Groq",text:"Groq"},{value:"Ollama",text:"Ollama"}].forEach(f=>{let b=this.providerSelect.createEl("option");b.value=f.value,b.textContent=f.text}),this.providerSelect.value="Google Gemini",this.providerSelect.addEventListener("change",()=>{this.selectedProvider=this.providerSelect.value,this.options.modelOptions&&this.updateModelDropdown(this.options.modelOptions)});let d=e.createDiv();d.style.cssText=`
            flex: 1;
            position: relative;
        `;let u=d.createDiv();u.style.cssText=`
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        `;let g=u.createDiv();g.textContent="Model",g.style.cssText=`
            font-weight: 500;
            color: var(--text-normal);
            font-size: 0.9rem;
        `;let m=u.createEl("button");m.innerHTML="\u{1F504}",m.style.cssText=`
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 2px 4px;
            border-radius: 4px;
            opacity: 0.7;
            transition: opacity 0.2s, background 0.2s;
        `,m.addEventListener("mouseenter",()=>{m.style.opacity="1",m.style.background="var(--background-modifier-hover)"}),m.addEventListener("mouseleave",()=>{m.style.opacity="0.7",m.style.background="none"}),m.addEventListener("click",async()=>{m.innerHTML="\u23F3",m.style.opacity="0.5",m.style.cursor="wait";try{if(this.options.fetchModels){let f=await this.options.fetchModels();this.updateModelDropdown(f),new O.Notice("Model list updated!")}}catch(f){new O.Notice("Failed to refresh models. Using cached options.")}finally{m.innerHTML="\u{1F504}",m.style.opacity="0.7",m.style.cursor="pointer"}}),this.modelSelect=d.createEl("select"),this.modelSelect.style.cssText=`
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            font-size: 0.9rem;
            background: var(--background-primary);
            color: var(--text-normal);
            cursor: pointer;
            outline: none;
            transition: all 0.2s ease;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            min-height: 40px;
        `,[{value:"gemini-2.5-pro",text:"Gemini Pro 2.5"},{value:"gemini-2.5-flash",text:"Gemini Flash 2.5"},{value:"gemini-1.5-pro",text:"Gemini Pro 1.5"},{value:"gemini-1.5-flash",text:"Gemini Flash 1.5"},{value:"qwen3-coder:480b-cloud",text:"Qwen3-Coder 480B Cloud"},{value:"llama3.2",text:"Llama 3.2"},{value:"llama3.1",text:"Llama 3.1"},{value:"mistral",text:"Mistral"},{value:"gemma2",text:"Gemma 2"},{value:"phi3",text:"Phi 3"}].forEach(f=>{let b=this.modelSelect.createEl("option");b.value=f.value,b.textContent=f.text}),this.modelSelect.value="gemini-2.5-pro",this.modelSelect.addEventListener("change",()=>{this.selectedModel=this.modelSelect.value})}updateModelDropdown(e){if(!this.modelSelect||!this.providerSelect)return;this.modelSelect.innerHTML="";let r=this.providerSelect.value,i=[];if(e&&e[r])i=e[r];else switch(r){case"Google Gemini":i=["gemini-2.5-pro","gemini-2.5-flash","gemini-1.5-pro","gemini-1.5-flash"];break;case"Groq":i=["llama-4-maverick-17b-128e-instruct","llama-4-scout-17b-16e-instruct","llama-3.3-70b-versatile","llama-3.1-8b-instant"];break;case"Ollama":i=["qwen3-coder:480b-cloud","llama3.2","llama3.1","mistral","mixtral","gemma2","phi3","qwen2","command-r"];break;default:i=[]}i.forEach(s=>{let n=this.modelSelect.createEl("option");n.value=s,n.textContent=this.formatModelName(s)}),this.selectedModel&&i.includes(this.selectedModel)?this.modelSelect.value=this.selectedModel:i.length>0&&(this.modelSelect.value=i[0],this.selectedModel=i[0])}formatModelName(e){return e==="gemini-2.5-pro"?"Gemini Pro 2.5":e==="gemini-2.5-flash"?"Gemini Flash 2.5":e==="gemini-1.5-pro"?"Gemini Pro 1.5":e==="gemini-1.5-flash"?"Gemini Flash 1.5":e==="qwen3-coder:480b-cloud"?"Qwen3-Coder 480B Cloud":e==="llama-4-maverick-17b-128e-instruct"?"Llama 4 Maverick 17B":e==="llama-4-scout-17b-16e-instruct"?"Llama 4 Scout 17B":e==="llama-3.3-70b-versatile"?"Llama 3.3 70B":e==="llama-3.1-8b-instant"?"Llama 3.1 8B":e.charAt(0).toUpperCase()+e.slice(1).replace(/[-_]/g," ")}createThemeToggle(){let e=this.contentEl.createDiv();e.style.cssText=`
            display: flex;
            justify-content: flex-end;
            margin: 8px 0 16px 0;
            padding: 0 4px;
        `;let r=e.createDiv();r.style.cssText=`
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--background-secondary);
            padding: 6px 12px;
            border-radius: 20px;
            border: 1px solid var(--background-modifier-border);
            transition: all 0.3s ease;
        `,r.addEventListener("mouseenter",()=>{r.style.borderColor="var(--interactive-accent)",r.style.boxShadow="0 2px 8px rgba(99, 102, 241, 0.2)"}),r.addEventListener("mouseleave",()=>{r.style.borderColor="var(--background-modifier-border)",r.style.boxShadow="none"});let i=r.createSpan();i.innerHTML="\u2600\uFE0F",i.style.cssText=`
            font-size: 1.1rem;
            transition: all 0.3s ease;
            opacity: ${this.isLightTheme?"1":"0.5"};
        `;let s=r.createEl("input");s.type="checkbox",s.checked=this.isLightTheme,s.style.cssText=`
            opacity: 0;
            width: 0;
            height: 0;
            position: absolute;
        `;let n=r.createDiv();n.style.cssText=`
            position: relative;
            width: 44px;
            height: 24px;
            background: ${this.isLightTheme?"var(--interactive-accent)":"var(--text-muted)"};
            border-radius: 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        `;let o=n.createDiv();o.style.cssText=`
            position: absolute;
            height: 18px;
            width: 18px;
            left: ${this.isLightTheme?"24px":"3px"};
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        `;let a=r.createSpan();a.innerHTML="\u{1F319}",a.style.cssText=`
            font-size: 1.1rem;
            transition: all 0.3s ease;
            opacity: ${this.isLightTheme?"0.5":"1"};
        `;let d=u=>{this.isLightTheme=u,s.checked=u,n.style.background=u?"var(--interactive-accent)":"var(--text-muted)",o.style.left=u?"24px":"3px",i.style.opacity=u?"1":"0.5",a.style.opacity=u?"0.5":"1",this.applyTheme(u),localStorage.setItem("ytc-theme-mode",u?"light":"dark")};n.addEventListener("click",()=>{d(!this.isLightTheme)}),s.addEventListener("change",()=>{d(s.checked)}),this.themeElements={slider:n,knob:o,sunIcon:i,moonIcon:a,updateTheme:d}}applyTheme(e){var r,i,s;if(!document.getElementById("ytc-theme-styles")){let n=document.createElement("style");n.id="ytc-theme-styles";let o="";o+=".ytc-modal-light {",o+="--ytc-bg-primary: #ffffff;",o+="--ytc-bg-secondary: #f8f9fa;",o+="--ytc-bg-tertiary: #e9ecef;",o+="--ytc-text-primary: #212529;",o+="--ytc-text-secondary: #6c757d;",o+="--ytc-text-muted: #adb5bd;",o+="--ytc-border: #dee2e6;",o+="--ytc-accent: #0d6efd;",o+="--ytc-accent-hover: #0b5ed7;",o+="--ytc-success: #198754;",o+="--ytc-warning: #ffc107;",o+="--ytc-error: #dc3545;",o+="--ytc-shadow: rgba(0, 0, 0, 0.1);",o+="}",o+=".ytc-modal-dark {",o+="--ytc-bg-primary: #1e1e1e;",o+="--ytc-bg-secondary: #252526;",o+="--ytc-bg-tertiary: #3c3c3c;",o+="--ytc-text-primary: #ffffff;",o+="--ytc-text-secondary: #e0e0e0;",o+="--ytc-text-muted: #a0a0a0;",o+="--ytc-border: #3c3c3c;",o+="--ytc-accent: #4a9eff;",o+="--ytc-accent-hover: #3a8eef;",o+="--ytc-success: #4caf50;",o+="--ytc-warning: #ff9800;",o+="--ytc-error: #f44336;",o+="--ytc-shadow: rgba(0, 0, 0, 0.3);",o+="}",n.innerHTML=o,document.head.appendChild(n)}(r=this.modalEl)==null||r.classList.add("ytc-themed-modal"),(i=this.modalEl)==null||i.classList.toggle("ytc-modal-light",e),(s=this.modalEl)==null||s.classList.toggle("ytc-modal-dark",!e),this.formatSelect&&(this.formatSelect.style.background="var(--ytc-bg-primary)",this.formatSelect.style.color="var(--ytc-text-primary)",this.formatSelect.style.borderColor="var(--ytc-border)"),this.providerSelect&&(this.providerSelect.style.background="var(--ytc-bg-primary)",this.providerSelect.style.color="var(--ytc-text-primary)",this.providerSelect.style.borderColor="var(--ytc-border)"),this.modelSelect&&(this.modelSelect.style.background="var(--ytc-bg-primary)",this.modelSelect.style.color="var(--ytc-text-primary)",this.modelSelect.style.borderColor="var(--ytc-border)"),this.headerEl&&(this.headerEl.style.color="var(--ytc-text-primary)"),this.progressText&&(this.progressText.style.color="var(--ytc-text-primary)")}createProgressSection(){this.progressContainer=this.contentEl.createDiv(),this.progressContainer.setAttribute("role","region"),this.progressContainer.setAttribute("aria-label","Processing progress"),this.progressContainer.setAttribute("aria-live","polite"),this.progressContainer.style.marginTop="16px",this.progressContainer.style.display="none",this.progressText=this.progressContainer.createDiv(),this.progressText.id="progress-text",this.progressText.style.marginBottom="8px",this.progressText.style.fontWeight="500",this.progressText.style.color="var(--text-accent)",this.progressText.textContent="Processing video...";let e=this.progressContainer.createDiv();e.setAttribute("role","progressbar"),e.setAttribute("aria-valuenow","0"),e.setAttribute("aria-valuemin","0"),e.setAttribute("aria-valuemax","100"),e.setAttribute("aria-labelledby","progress-text"),e.style.width="100%",e.style.height="10px",e.style.backgroundColor="var(--background-modifier-border)",e.style.borderRadius="5px",e.style.overflow="hidden",this.progressBar=e.createDiv(),this.progressBar.style.height="100%",this.progressBar.style.backgroundColor="var(--interactive-accent)",this.progressBar.style.borderRadius="5px",this.progressBar.style.width="0%",this.progressBar.style.transition="width 0.3s ease"}createActionButtons(){let e=this.contentEl.createDiv();e.style.cssText=`
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--background-modifier-border);
        `;let r=e.createEl("button");r.textContent=p.MODALS.CANCEL,r.style.cssText=`
            padding: 8px 16px;
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            background: var(--background-secondary);
            color: var(--text-normal);
            transition: all 0.2s ease;
        `,r.addEventListener("click",()=>this.close()),this.processButton=e.createEl("button"),this.processButton.textContent=p.MODALS.PROCESS,this.processButton.style.cssText=`
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            background: var(--interactive-accent);
            color: var(--text-on-accent);
            transition: all 0.2s ease;
        `,this.processButton.addEventListener("click",()=>this.handleProcess()),this.openButton=e.createEl("button"),this.openButton.textContent="Open Note",this.openButton.style.cssText=`
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            background: var(--interactive-accent);
            color: var(--text-on-accent);
            transition: all 0.2s ease;
        `,this.openButton.style.display="none",this.openButton.addEventListener("click",()=>this.handleOpenFile()),this.updateProcessButtonState()}setupEventHandlers(){this.scope.register([],"Enter",()=>(this.processButton&&!this.processButton.disabled&&this.processButton.click(),!1)),this.scope.register([],"Escape",()=>(this.close(),!1)),this.urlInput&&this.urlInput.addEventListener("input",()=>{this.url=this.urlInput.value,this.updateProcessButtonState()})}focusUrlInput(){this.urlInput&&this.urlInput.focus()}updateProcessButtonState(){if(!this.processButton)return;let e=this.url.trim(),r=h.isValidYouTubeUrl(e);this.processButton.disabled=!r||this.isProcessing,this.processButton.style.opacity=this.processButton.disabled?"0.5":"1",e.length===0?this.setValidationMessage("Paste a YouTube link to begin processing.","info"):this.setValidationMessage(r?"Ready to process this video.":"Enter a valid YouTube video URL.",r?"success":"error")}setValidationMessage(e,r="info"){if(!this.validationMessage)return;this.validationMessage.textContent=e;let i="var(--text-muted)";r==="error"?i="var(--text-error)":r==="success"&&(i="var(--text-accent)"),this.validationMessage.style.color=i}async handleProcess(){let e=this.url.trim();if(!e){new O.Notice(p.ERRORS.ENTER_URL),this.focusUrlInput();return}if(!h.isValidYouTubeUrl(e)){new O.Notice(p.ERRORS.INVALID_URL),this.focusUrlInput();return}try{if(this.showProcessingState(),this.updateProgress(0,"Starting..."),this.updateProgress(25,"Validating URL..."),!h.extractVideoId(e))throw new Error("Could not extract YouTube video ID");this.updateProgress(50,"Fetching video data..."),this.updateProgress(75,"Processing with AI..."),this.format=this.formatSelect.value,this.selectedProvider=this.providerSelect.value,this.selectedModel=this.modelSelect.value;let i=await this.options.onProcess(e,this.format,this.selectedProvider,this.selectedModel,(this.format==="custom",void 0),this.options.performanceMode||"balanced",this.options.enableParallelProcessing||!1,this.options.preferMultimodal||!1,this.options.defaultMaxTokens||4096,this.options.defaultTemperature||.5);this.updateProgress(100,"Complete!"),this.processedFilePath=i,this.showCompletionState()}catch(r){this.showErrorState(r),y.handle(r,"YouTube URL processing")}}showProcessingState(){this.isProcessing=!0,this.progressContainer&&(this.progressContainer.style.display="block"),this.urlInput&&(this.urlInput.disabled=!0),this.processButton&&(this.processButton.disabled=!0,this.processButton.textContent="Processing..."),this.openButton&&(this.openButton.style.display="none")}updateProgress(e,r){this.progressBar&&(this.progressBar.style.width=`${e}%`),this.progressText&&(this.progressText.textContent=r)}showCompletionState(){this.isProcessing=!1,this.urlInput&&(this.urlInput.disabled=!1,this.urlInput.value="",this.url=""),this.processButton&&(this.processButton.disabled=!1,this.processButton.textContent="Process Another",this.processButton.style.display="inline-block"),this.openButton&&(this.openButton.style.display="inline-block"),this.headerEl&&(this.headerEl.textContent="\u2705 Video Processed Successfully!"),this.setValidationMessage("Note saved. You can open it now or process another video.","success"),this.focusUrlInput()}showErrorState(e){this.isProcessing=!1,this.urlInput&&(this.urlInput.disabled=!1),this.processButton&&(this.processButton.disabled=!1,this.processButton.textContent=p.MODALS.PROCESS),this.openButton&&(this.openButton.style.display="none"),this.headerEl&&(this.headerEl.textContent="\u274C Processing Failed"),this.setValidationMessage(e.message,"error")}async handleOpenFile(){if(this.processedFilePath&&this.options.onOpenFile)try{await this.options.onOpenFile(this.processedFilePath),this.close()}catch(e){y.handle(e,"Opening file")}}setUrl(e){this.url=e,this.urlInput&&(this.urlInput.value=e),this.updateProcessButtonState()}async handleSmartPaste(){try{let r=(await navigator.clipboard.readText()).trim();if(h.isValidYouTubeUrl(r))this.setUrl(r),new O.Notice("YouTube URL detected and pasted!");else{let i=r.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/);if(i){let n=`https://www.youtube.com/watch?v=${i[1]}`;this.setUrl(n),new O.Notice("YouTube URL extracted from clipboard!")}else new O.Notice("No YouTube URL found in clipboard")}this.processButton&&!this.isProcessing&&h.isValidYouTubeUrl(r)?this.processButton.focus():this.focusUrlInput()}catch(e){new O.Notice("Could not access clipboard")}}setupKeyboardShortcuts(){let e=r=>{r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement||((r.ctrlKey||r.metaKey)&&r.key==="Enter"&&(r.preventDefault(),this.processButton&&!this.processButton.disabled&&this.processButton.click()),r.key==="Escape"&&this.close())};this.scope.register(["Ctrl"],"Enter",()=>(this.processButton&&!this.processButton.disabled&&this.processButton.click(),!1))}onClose(){this.validationTimer&&clearTimeout(this.validationTimer),super.onClose()}};var Ge=require("obsidian");var S=require("obsidian"),Ve="ytp",ze="1.3.5",Ye={geminiApiKey:"",groqApiKey:"",ollamaApiKey:"",outputPath:"YouTube/Processed Videos",useEnvironmentVariables:!1,environmentPrefix:"YTC",performanceMode:"balanced",enableParallelProcessing:!0,preferMultimodal:!0,defaultMaxTokens:4096,defaultTemperature:.5},fe=class extends S.Plugin{constructor(){super(...arguments);this._settings=Ye;this.isUnloading=!1;this.operationCount=0}async onload(){this.manifest.version=ze,c.info(`Initializing YoutubeClipper Plugin v${ze}...`);try{await this.loadSettings(),this.setupLogger(),await this.initializeServices(),this.registerUIComponents(),this.setupUrlHandling(),this.setupProtocolHandler(),c.plugin("Plugin loaded successfully")}catch(e){c.error("Failed to load plugin","Plugin",{error:e instanceof Error?e.message:String(e)}),y.handle(e,"Plugin initialization"),new S.Notice("Failed to load YoutubeClipper Plugin. Check console for details.")}}onunload(){var e,r,i;c.plugin("Unloading YoutubeClipper Plugin..."),this.isUnloading=!0;try{(e=this.urlHandler)==null||e.clear(),(r=this.modalManager)==null||r.clear(),(i=this.serviceContainer)==null||i.clearServices(),this.cleanupUIElements(),I.cleanupAllElements(),c.plugin("Plugin unloaded successfully")}catch(s){c.error("Error during plugin unload","Plugin",{error:s instanceof Error?s.message:String(s)})}}setupLogger(){c.updateConfig({level:1,enableConsole:!0,enableFile:!1,maxLogEntries:1e3})}async initializeServices(){this.serviceContainer=new W(this._settings,this.app),this.modalManager=new Z,this.urlHandler=new me(this.app,this._settings,this.handleUrlDetection.bind(this))}setupUrlHandling(){this.urlHandler&&(this.registerEvent(this.app.vault.on("create",e=>{e instanceof S.TFile&&this.safeOperation(()=>this.urlHandler.handleFileCreate(e),"Handle file create")})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.safeOperation(()=>this.urlHandler.handleActiveLeafChange(),"Handle active leaf change")})))}setupProtocolHandler(){var e;try{(e=this.registerObsidianProtocolHandler)==null||e.call(this,"youtube-clipper",r=>{var i;(i=this.urlHandler)==null||i.handleProtocol(r)})}catch(r){c.debug("Protocol handler not available","Plugin")}}registerUIComponents(){this.ribbonIcon=this.addRibbonIcon("film","Process YouTube Video",()=>{console.log("[YT-CLIPPER] Ribbon icon clicked"),this.safeShowUrlModal()}),c.plugin("Ribbon icon set successfully"),this.addCommand({id:`${Ve}-process-youtube-video`,name:"Process YouTube Video",callback:()=>{console.log("[YT-CLIPPER] Ribbon icon clicked"),this.safeShowUrlModal()}}),this.addSettingTab(new he(this.app,{plugin:this,onSettingsChange:this.handleSettingsChange.bind(this)})),this.addCommand({id:`${Ve}-open-url-from-clipboard`,name:"YouTube Clipper: Open URL Modal (from clipboard)",callback:async()=>{await this.handleClipboardUrl()}})}cleanupUIElements(){this.ribbonIcon&&(this.ribbonIcon.remove(),this.ribbonIcon=null)}handleUrlDetection(e){c.info("URL detected, opening modal","Plugin",{url:e.url,source:e.source,filePath:e.filePath}),this.safeShowUrlModal(e.url)}async handleClipboardUrl(){try{if(!this.urlHandler)return;await this.urlHandler.handleClipboardUrl();let e=window.prompt("Paste YouTube URL to open in YouTube Clipper:");e&&h.isValidYouTubeUrl(e.trim())?this.safeShowUrlModal(e.trim()):new S.Notice("No valid YouTube URL provided.")}catch(e){y.handle(e,"Open URL from clipboard")}}async safeShowUrlModal(e){console.log("[YT-CLIPPER] safeShowUrlModal called",{initialUrl:e,hasModalManager:!!this.modalManager,hasServiceContainer:!!this.serviceContainer}),!(!this.modalManager||!this.serviceContainer)&&await this.safeOperation(async()=>this.modalManager.openModal(e,()=>this.openYouTubeUrlModal(e),()=>{c.debug("Modal closed","Plugin",{url:e})}),"Show URL Modal")}async openYouTubeUrlModal(e){if(console.log("[YT-CLIPPER] openYouTubeUrlModal called",{initialUrl:e}),this.isUnloading){I.log("Plugin is unloading, ignoring modal request");return}I.safeOperation(async()=>{if(!this.serviceContainer)return;let r=this.serviceContainer.aiService,i=r?r.getProviderNames():[],s=this._settings.modelOptionsCache||{};if(r&&(!this._settings.modelOptionsCache||Object.keys(this._settings.modelOptionsCache).length===0))for(let o of i)s[o]=r.getProviderModels(o)||[];new ge(this.app,{onProcess:this.processYouTubeVideo.bind(this),onOpenFile:this.openFileByPath.bind(this),...e&&{initialUrl:e},providers:i,defaultProvider:"Google Gemini",defaultModel:"gemini-2.5-pro",defaultMaxTokens:this._settings.defaultMaxTokens,defaultTemperature:this._settings.defaultTemperature,modelOptions:s,fetchModels:async()=>{try{let o=await this.serviceContainer.aiService.fetchLatestModels();return this._settings.modelOptionsCache=o,await this.saveSettings(),o}catch(o){return s}},performanceMode:this._settings.performanceMode||"balanced",enableParallelProcessing:this._settings.enableParallelProcessing||!1,preferMultimodal:this._settings.preferMultimodal||!1,onPerformanceSettingsChange:async(o,a,d)=>{this._settings.performanceMode=o,this._settings.enableParallelProcessing=a,this._settings.preferMultimodal=d,await this.saveSettings(),this.serviceContainer=new W(this._settings,this.app)}}).open()},"YouTube URL Modal").catch(r=>{y.handle(r,"Opening YouTube URL modal")})}async processYouTubeVideo(e,r="detailed-guide",i,s,n,o,a,d,u,g){if(this.isUnloading)throw I.log("Plugin is unloading, cancelling video processing"),new Error("Plugin is shutting down");let m=await I.safeOperation(async()=>{var Me,Re;new S.Notice(p.PROCESSING);let v=h.validateSettings(this._settings);if(!v.isValid)throw new Error(`Configuration invalid: ${v.errors.join(", ")}`);if(!this.serviceContainer)throw new Error("Service container not initialized");let f=this.serviceContainer.videoService,b=this.serviceContainer.aiService,B=this.serviceContainer.fileService,x=this.serviceContainer.promptService,T=f.extractVideoId(e);if(!T)throw new Error(p.ERRORS.VIDEO_ID_EXTRACTION);let H=await f.getVideoData(T),ve;r==="custom"?ve=n:ve=(Me=this._settings.customPrompts)==null?void 0:Me[r];let Pe=x.createAnalysisPrompt(H,e,r,ve);c.aiService("Processing video",{videoId:T,format:r,provider:i||"Auto",model:s||"Default",maxTokens:u||2048,temperature:g||.7});let Ke=b.providers||[];for(let P of Ke)u&&P.setMaxTokens&&P.setMaxTokens(u),g!==void 0&&P.setTemperature&&P.setTemperature(g);let L;try{i?L=await b.processWith(i,Pe,s,void 0):L=await b.process(Pe),c.aiService("AI Response received",{provider:L.provider,model:L.model,contentLength:((Re=L.content)==null?void 0:Re.length)||0})}catch(P){throw c.error("AI Processing failed","Plugin",{error:P instanceof Error?P.message:String(P)}),P instanceof Error&&y.handleEnhanced(P,"AI Processing"),P}let We=x.processAIResponse(L.content,L.provider,L.model,r,H,e),je=await B.saveToFile(H.title,We,this._settings.outputPath);return new S.Notice(p.SUCCESS(H.title)),je},"YouTube Video Processing");if(!m)throw new Error("Failed to process YouTube video");return m}async openFileByPath(e){try{await new Promise(s=>setTimeout(s,300));let r=e.startsWith("/")?e.substring(1):e,i=this.app.vault.getAbstractFileByPath(r);if(!i||!(i instanceof S.TFile))throw new Error(`File not found at path: ${r}`);await this.openFileInNewTab(i)}catch(r){throw y.handle(r,"Opening file by path"),r}}async openFileInNewTab(e){try{let r=this.app.workspace.getLeaf("tab");await r.openFile(e),this.app.workspace.setActiveLeaf(r),new S.Notice(`\u{1F4C2} Opened: ${e.name}`)}catch(r){try{await this.app.workspace.getLeaf(!1).openFile(e),new S.Notice(`\u{1F4C2} Opened: ${e.name}`)}catch(i){y.handle(i,"Opening file in current tab"),new S.Notice(`Note saved as "${e.name}" but could not auto-open. Please open manually.`)}}}async handleSettingsChange(e){var r,i;try{this._settings={...e},await this.saveSettings(),await((r=this.serviceContainer)==null?void 0:r.updateSettings(this._settings)),(i=this.urlHandler)==null||i.updateSettings(this._settings)}catch(s){throw y.handle(s,"Settings update"),s}}async loadSettings(){this._settings=Object.assign({},Ye,await this.loadData())}async saveSettings(){await this.saveData(this._settings)}async safeOperation(e,r){if(this.isUnloading)return c.warn(`Attempted ${r} during plugin unload - skipping`,"Plugin"),null;let i=++this.operationCount;c.info(`Starting operation ${i}: ${r}`,"Plugin");try{let s=await e();return c.info(`Completed operation ${i}: ${r}`,"Plugin"),s}catch(s){return c.error(`Failed operation ${i}: ${r}`,"Plugin",{error:s instanceof Error?s.message:String(s)}),y.handle(s,r),null}}getServiceContainer(){return this.serviceContainer}getUrlHandler(){return this.urlHandler}getModalManager(){return this.modalManager}getCurrentSettings(){return{...this._settings}}get settings(){return this._settings}};
